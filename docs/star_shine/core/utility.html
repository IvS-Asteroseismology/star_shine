<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>star_shine.core.utility API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../core.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;star_shine.core</a>

            <img src="https://github.com/LucIJspeert/star_shine/blob/master/star_shine/data/images/Star_Shine_small_transparent.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#config">config</a>
            </li>
            <li>
                    <a class="function" href="#datetime_formatted">datetime_formatted</a>
            </li>
            <li>
                    <a class="function" href="#decimal_figures">decimal_figures</a>
            </li>
            <li>
                    <a class="function" href="#float_to_str_numba">float_to_str_numba</a>
            </li>
            <li>
                    <a class="function" href="#float_to_str_scientific">float_to_str_scientific</a>
            </li>
            <li>
                    <a class="function" href="#weighted_mean">weighted_mean</a>
            </li>
            <li>
                    <a class="function" href="#std_unb">std_unb</a>
            </li>
            <li>
                    <a class="function" href="#consecutive_subsets">consecutive_subsets</a>
            </li>
            <li>
                    <a class="function" href="#adjust_indices_removed">adjust_indices_removed</a>
            </li>
            <li>
                    <a class="function" href="#find_local_max">find_local_max</a>
            </li>
            <li>
                    <a class="function" href="#uphill_local_max">uphill_local_max</a>
            </li>
            <li>
                    <a class="function" href="#mask_between">mask_between</a>
            </li>
            <li>
                    <a class="function" href="#mark_gaps">mark_gaps</a>
            </li>
            <li>
                    <a class="function" href="#n_parameters">n_parameters</a>
            </li>
            <li>
                    <a class="function" href="#correct_for_crowdsap">correct_for_crowdsap</a>
            </li>
            <li>
                    <a class="function" href="#model_crowdsap">model_crowdsap</a>
            </li>
            <li>
                    <a class="function" href="#formal_uncertainties_linear">formal_uncertainties_linear</a>
            </li>
            <li>
                    <a class="function" href="#formal_uncertainties_sinusoid">formal_uncertainties_sinusoid</a>
            </li>
            <li>
                    <a class="function" href="#formal_uncertainties_harmonic">formal_uncertainties_harmonic</a>
            </li>
            <li>
                    <a class="function" href="#formal_uncertainties">formal_uncertainties</a>
            </li>
            <li>
                    <a class="function" href="#linear_regression_uncertainty_ephem">linear_regression_uncertainty_ephem</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../star_shine.html">star_shine</a><wbr>.<a href="./../core.html">core</a><wbr>.utility    </h1>

                        <div class="docstring"><p>STAR SHINE
Satellite Time-series Analysis Routine using Sinusoids and Harmonics through Iterative Non-linear Extraction</p>

<p>This module contains utility functions for data processing, unit conversions.</p>
</div>

                        <input id="mod-utility-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-utility-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;STAR SHINE</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Satellite Time-series Analysis Routine using Sinusoids and Harmonics through Iterative Non-linear Extraction</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">This module contains utility functions for data processing, unit conversions.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nb</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">star_shine.config.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_config</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># load configuration</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="k">def</span><span class="w"> </span><span class="nf">datetime_formatted</span><span class="p">():</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return datetime string without microseconds.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">    Returns</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    -------</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    str</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">        Date and time without microseconds</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="n">dt_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="k">return</span> <span class="n">dt_str</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="k">def</span><span class="w"> </span><span class="nf">decimal_figures</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_sf</span><span class="p">):</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the number of decimal figures to print given a target</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    number of significant figures</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    Parameters</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    ----------</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    x: float</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        Value to determine the number of decimals for.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    n_sf: int</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        Number of significant figures to compute.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    Returns</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    -------</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    int</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        Number of decimal places to round to.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="n">decimals</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_sf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="n">decimals</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="k">return</span> <span class="n">decimals</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="k">def</span><span class="w"> </span><span class="nf">float_to_str_numba</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert float to string for Numba up to some decimal place</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    </span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    Parameters</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    ----------</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    x: float</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        Value to convert</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    dec: int</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        Number of decimals (be careful with large numbers here)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    </span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">    Returns</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    -------</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    str</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        String with the value x</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="n">x_round</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="n">x_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_round</span><span class="p">)</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="n">x_dec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x_round</span> <span class="o">-</span> <span class="n">x_int</span><span class="p">,</span> <span class="n">dec</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">dec</span><span class="p">)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_int</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_dec</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="k">return</span> <span class="n">s</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="k">def</span><span class="w"> </span><span class="nf">float_to_str_scientific</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_err</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">brackets</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Conversion of a number with an error margin to string in scientific notation.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    Uses two significant figures by default as no distinction is made between having a 1, 2 or higher number</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    in the error value.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    Parameters</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    ----------</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    x: float</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        Value to determine the number of decimals for.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    x_err: float</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        Value to determine the number of decimals for.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    error: bool, optional</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        Include the error value.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    brackets: bool, optional</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        Place the error value in brackets.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">    Returns</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">    -------</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">    str</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        Formatted string conversion.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>    <span class="c1"># determine the decimal places to round to</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="n">rnd_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">decimal_figures</span><span class="p">(</span><span class="n">x_err</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">decimal_figures</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="c1"># format the error value</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="k">if</span> <span class="n">brackets</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="n">err_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="se">\u00B1</span><span class="si">{</span><span class="n">x_err</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">rnd_x</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="n">err_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{</span><span class="n">x_err</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">rnd_x</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="c1"># format the rest of the string</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="n">number_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">rnd_x</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">err_str</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">number_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">rnd_x</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="k">return</span> <span class="n">number_str</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="k">def</span><span class="w"> </span><span class="nf">weighted_mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Weighted mean since Numba doesn&#39;t support numpy.average</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">    </span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">    Parameters</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">    ----------</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        Values to calculate the mean over</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">    w: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        Weights corresponding to each value</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">    </span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">    Returns</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">    -------</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">    float</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        Mean of x weighted by w</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="n">w_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="k">return</span> <span class="n">w_mean</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="k">def</span><span class="w"> </span><span class="nf">std_unb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Unbiased standard deviation</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">    Parameters</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">    ----------</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        Values to calculate the std over</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">    n: int</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        Number of degrees of freedom</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    Returns</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">    -------</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">    float</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        Unbiased standard deviation</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>    <span class="n">residuals</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="c1"># tested to be faster in numba than np.sum(x**2)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">sum_r_2</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)):</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="n">sum_r_2</span> <span class="o">+=</span> <span class="n">residuals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sum_r_2</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># unbiased standard deviation of the residuals</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>    <span class="k">return</span> <span class="n">std</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="k">def</span><span class="w"> </span><span class="nf">consecutive_subsets</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates all consecutive subsets of the given list.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">    Parameters</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">    ----------</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">    x: list[Any], numpy.ndarray[Any, dtype[Any]]</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        A list of values.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">    Returns</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">    -------</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">    list</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        The list of consecutive subsets ordered by size and with length two or more.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>    <span class="c1"># create the subsets from largest to smallest</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="n">subsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">p1</span><span class="p">:</span><span class="n">p1</span> <span class="o">+</span> <span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="k">return</span> <span class="n">subsets</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="k">def</span><span class="w"> </span><span class="nf">adjust_indices_removed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">removed</span><span class="p">):</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjusts the indices in `x` to account for removals.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">    If y_reduced=np.delete(y, removed), and x are indices indicating items in y, this function gives</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">    the indices x_adj that indicate the same items in y_reduced. Assumes that none of the removed items</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">    are indicated by indices in x.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">    Parameters</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">    ----------</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">    x: iterable[int], numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        A list of indices that slice another array, y.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">    removed: iterable[int], numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        A second list of indices indicating removals from y.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">    Returns</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">    -------</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">    list[int]</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        Adjusted indices that can be used with the reduced y.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="c1"># adjust the indices</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>    <span class="n">x_adj</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">removed</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>    <span class="k">return</span> <span class="n">x_adj</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="k">def</span><span class="w"> </span><span class="nf">find_local_max</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the indeces of the local maxima in `y`.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">    The array `x` must be sorted in ascending order. This function identifies local maxima in the `y` array</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">    and returns the corresponding indeces.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">    Parameters</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">    ----------</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">    y: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        1D array of y-values corresponding to the x-values.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">    Returns</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">    -------</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">    numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        Indeces of the `x` values corresponding to the local maxima.</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">    Examples</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">    --------</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">    &gt;&gt;&gt; y = np.array([1, 3, 2, 5, 4, 6])</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">    &gt;&gt;&gt; find_local_max(y)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">    array([1, 3, 5])</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="c1"># differenced y</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>    <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>    <span class="c1"># sign of difference of y</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>    <span class="n">sign_dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>    <span class="n">sign_dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sign_dy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>  <span class="c1"># add 1 and -1 on the ends for maximum finding</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="c1"># find the maxima in y</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="n">extrema</span> <span class="o">=</span> <span class="n">sign_dy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">sign_dy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># places where the array dy changes sign</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>    <span class="n">maxima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extrema</span><span class="p">))[</span><span class="n">extrema</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># places where y has a maximum</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="k">return</span> <span class="n">maxima</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="k">def</span><span class="w"> </span><span class="nf">uphill_local_max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_approx</span><span class="p">):</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the index of the local maximum in `y` uphill from `x_approx`.</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">    The array `x` must be sorted in ascending order. This function identifies local maxima in the `y` array</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">    and returns the index of the `x` value corresponding to the local maximum uphill from `x_approx`.</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">    Parameters</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">    ----------</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">        1D array of x-values, which must be sorted in ascending order.</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">    y: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">        1D array of y-values corresponding to the x-values.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">    x_approx: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        The x-value(s) around which to find the nearest local maximum.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">    Returns</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">    -------</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">    numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        Index of the `x` value(s) corresponding to the nearest local maximum to `x_approx`.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">    Examples</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">    --------</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">    &gt;&gt;&gt; x = np.array([1, 2, 3, 4, 5, 6])</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">    &gt;&gt;&gt; y = np.array([1, 3, 2, 5, 4, 6])</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">    &gt;&gt;&gt; x_approx = np.array([2.4, 4.6])</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">    &gt;&gt;&gt; uphill_local_max(x, y, x_approx)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">    array([1, 3])</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>    <span class="c1"># [note] this is find_local_max(y), but since we need sign_dy we do this here</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>    <span class="c1"># differenced y</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>    <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="c1"># find the maxima in y</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>    <span class="n">sign_dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>    <span class="n">sign_dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sign_dy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>  <span class="c1"># add 1 and -1 on the ends for maximum finding</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>    <span class="n">extrema</span> <span class="o">=</span> <span class="n">sign_dy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">sign_dy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># places where the array dy changes sign</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>    <span class="n">maxima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extrema</span><span class="p">))[</span><span class="n">extrema</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># places where y has a maximum</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>    <span class="c1"># position of x_approx in x (index is point to the right of x_approx)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>    <span class="n">pos_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_approx</span><span class="p">)</span>  <span class="c1"># pos_x can be 0 and len(x) but this is ok for sign_dy</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="c1"># do we need to move left or right to get to the maximum</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>    <span class="n">left_right</span> <span class="o">=</span> <span class="n">sign_dy</span><span class="p">[</span><span class="n">pos_x</span><span class="p">]</span>  <span class="c1"># negative: left, positive: right</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>    <span class="c1"># get the maximum for each x_approx (index is maximum to the right of pos_x)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>    <span class="n">pos_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">maxima</span><span class="p">,</span> <span class="n">pos_x</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="c1"># take the maximum on the left for negative slopes</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="n">pos_max</span><span class="p">[</span><span class="n">left_right</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="n">x_max</span> <span class="o">=</span> <span class="n">maxima</span><span class="p">[</span><span class="n">pos_max</span><span class="p">]</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="k">return</span> <span class="n">x_max</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mask_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mask out everything except the parts between the given timestamps</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">    Parameters</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">    ----------</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        Time series to be masked.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">    locations: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        Pairs of points in the time series. Everything but the space between points is masked.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">    Returns</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">    -------</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">    numpy.ndarray[bool]</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        Boolean mask that is True between the locations.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="k">return</span> <span class="n">mask</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mark_gaps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">min_gap</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark gaps in a time series.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">    Parameters</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">    ----------</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        Time series with gaps.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">    min_gap: float, optional</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        Minimum width for a gap (in time units).</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">    Returns</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">    -------</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">    gaps: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">        Gap timestamps in pairs.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>    <span class="c1"># mark the gaps</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>    <span class="n">t_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="n">t_diff</span> <span class="o">=</span> <span class="n">t_sorted</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">t_sorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># np.diff(a)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="n">gaps</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_diff</span> <span class="o">&gt;</span> <span class="n">min_gap</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="c1"># get the timestamps</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>    <span class="n">t_left</span> <span class="o">=</span> <span class="n">t_sorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">gaps</span><span class="p">]</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>    <span class="n">t_right</span> <span class="o">=</span> <span class="n">t_sorted</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">gaps</span><span class="p">]</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="n">gaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">t_left</span><span class="p">,</span> <span class="n">t_right</span><span class="p">))</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>    <span class="k">return</span> <span class="n">gaps</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="k">def</span><span class="w"> </span><span class="nf">n_parameters</span><span class="p">(</span><span class="n">n_chunks</span><span class="p">,</span> <span class="n">n_sinusoids</span><span class="p">,</span> <span class="n">n_harmonics</span><span class="p">):</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the number of parameters of the model.&quot;&quot;&quot;</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>    <span class="c1"># equation for number of parameters</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>    <span class="n">n_param</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_chunks</span>  <span class="c1"># time chunk each with constant and slope</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="n">n_param</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_harmonics</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># one period if harmonics present</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="n">n_param</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_harmonics</span>  <span class="c1"># harmonics (sinusoids with constrained frequency)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="n">n_param</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_sinusoids</span> <span class="o">-</span> <span class="n">n_harmonics</span><span class="p">)</span>  <span class="c1"># sinusoids with free frequency</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>    <span class="k">return</span> <span class="n">n_param</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="k">def</span><span class="w"> </span><span class="nf">correct_for_crowdsap</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">crowdsap</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Correct the flux for flux contribution of a third source</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">    </span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">    Parameters</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">    ----------</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">    flux: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        Measurement values of the time series</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">    crowdsap: list[float], numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        Light contamination parameter (1-third_light) listed per sector</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">    </span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">    Returns</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">    -------</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">    numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        Measurement values of the time series corrected for</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        contaminating light</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">    </span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">    Notes</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">    -----</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">    Uses the parameter CROWDSAP included with some TESS data.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">    flux_corrected = (flux - (1 - crowdsap)) / crowdsap</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">    where all quantities are median-normalised, including the result.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">    This corresponds to subtracting a fraction of (1 - crowdsap) of third light</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">    from the (non-median-normalised) flux measurements.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="n">cor_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">):</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="n">crowd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">crowdsap</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">1.</span><span class="p">)</span>  <span class="c1"># clip to avoid unphysical output</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">cor_flux</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">crowd</span><span class="p">)</span> <span class="o">/</span> <span class="n">crowd</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>    <span class="k">return</span> <span class="n">cor_flux</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="k">def</span><span class="w"> </span><span class="nf">model_crowdsap</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">crowdsap</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Incorporate flux contribution of a third source into the flux</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">    Parameters</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">    ----------</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">    flux: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        Measurement values of the time series</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">    crowdsap: list[float], numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        Light contamination parameter (1-third_light) listed per sector</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">    Returns</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">    -------</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">    numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">        Model of the flux incorporating light contamination</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">    Notes</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">    -----</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">    Does the opposite as correct_for_crowdsap, to be able to model the effect of</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">    third light to some degree (can only achieve an upper bound on CROWDSAP).</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">):</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">crowd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">crowdsap</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">1.</span><span class="p">)</span>  <span class="c1"># clip to avoid unphysical output</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">model</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">crowd</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">crowd</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="k">def</span><span class="w"> </span><span class="nf">formal_uncertainties_linear</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the corrected uncorrelated (formal) uncertainties for the</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">    parameters constant and slope.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">    Parameters</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">    ----------</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">    time: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        Timestamps of the time series</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">    residuals: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        Residual is flux - model</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">    Returns</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">    -------</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">    tuple</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">        A tuple containing the following elements:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        sigma_const: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">            Uncertainty in the constant for each sector</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        sigma_slope: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">            Uncertainty in the slope for each sector</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">    Notes</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">    -----</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">    Errors in const and slope:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">    https://pages.mtu.edu/~fmorriso/cm3215/UncertaintySlopeInterceptOfLeastSquaresFit.pdf</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>    <span class="n">n_param</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>    <span class="c1"># linear regression uncertainties</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>    <span class="n">sigma_const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">))</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>    <span class="n">sigma_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">))</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="n">len_t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># same as len_t, but just for the sake of clarity</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">n_dof</span> <span class="o">=</span> <span class="n">n_data</span> <span class="o">-</span> <span class="n">n_param</span>  <span class="c1"># degrees of freedom</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="c1"># standard deviation of the residuals but per sector</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="n">std</span> <span class="o">=</span> <span class="n">std_unb</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">n_dof</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="c1"># some sums for the uncertainty formulae</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="n">sum_t</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>            <span class="n">sum_t</span> <span class="o">+=</span> <span class="n">t</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="n">ss_xx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="n">ss_xx</span> <span class="o">+=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">sum_t</span> <span class="o">/</span> <span class="n">len_t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="n">sigma_const</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_data</span> <span class="o">+</span> <span class="p">(</span><span class="n">sum_t</span> <span class="o">/</span> <span class="n">len_t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">ss_xx</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="n">sigma_slope</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ss_xx</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>    <span class="k">return</span> <span class="n">sigma_const</span><span class="p">,</span> <span class="n">sigma_slope</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="k">def</span><span class="w"> </span><span class="nf">formal_uncertainties_sinusoid</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">flux_err</span><span class="p">,</span> <span class="n">a_n</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the corrected uncorrelated (formal) uncertainties for the frequencies, amplitudes, and phases.</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">    Harmonics are not taken into account.</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">    Parameters</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">    ----------</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">    time: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">        Timestamps of the time series</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">    residuals: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        Residual is flux - model</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">    flux_err: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        Errors in the measurement values</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">    a_n: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        The amplitudes of a number of sinusoids</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">    Returns</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">    -------</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">    tuple</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">        A tuple containing the following elements:</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">        sigma_f: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">            Uncertainty in the frequency for each sinusoid.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        sigma_a: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">            Uncertainty in the amplitude for each sinusoid (these are identical).</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        sigma_ph: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">            Uncertainty in the phase for each sinusoid.</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">    Notes</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">    -----</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">    As in Aerts 2021, https://ui.adsabs.harvard.edu/abs/2021RvMP...93a5001A/abstract</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">    The sigma value in the formulae is approximated by taking the maximum of the</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">    standard deviation of the residuals and the standard error of the minimum data error.</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>    <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>    <span class="n">n_param</span> <span class="o">=</span> <span class="n">n_parameters</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_n</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># number of parameters in the model</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>    <span class="n">n_dof</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_data</span> <span class="o">-</span> <span class="n">n_param</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># degrees of freedom</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>    <span class="c1"># calculate the standard deviation of the residuals</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">std_unb</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">n_dof</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>    <span class="c1"># calculate the standard error based on the smallest data error</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>    <span class="n">ste</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flux_err</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>    <span class="c1"># take the maximum of the standard deviation and standard error as sigma N</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>    <span class="n">sigma_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">ste</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>    <span class="c1"># calculate the D factor (square root of the average number of consecutive data points of the same sign)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>    <span class="n">positive</span> <span class="o">=</span> <span class="p">(</span><span class="n">residuals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>    <span class="n">zero_crossings</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">positive</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">positive</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)]</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>    <span class="n">sss_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">zero_crossings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_data</span><span class="p">])))</span>  <span class="c1"># same-sign sequence indices</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>    <span class="n">d_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sss_i</span><span class="p">)))</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="c1"># uncertainty formulae for sinusoids</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>    <span class="n">sigma_f</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>    <span class="n">sigma_ph</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span> <span class="o">/</span> <span class="n">a_n</span>  <span class="c1"># times 2 pi w.r.t. the paper</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>    <span class="c1"># make an array of sigma_a (these are the same)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_n</span><span class="p">),</span> <span class="n">sigma_a</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>    <span class="k">return</span> <span class="n">sigma_f</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_ph</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="k">def</span><span class="w"> </span><span class="nf">formal_uncertainties_harmonic</span><span class="p">(</span><span class="n">sigma_f</span><span class="p">,</span> <span class="n">h_base</span><span class="p">,</span> <span class="n">h_mult</span><span class="p">):</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the uncertainty in the harmonic frequencies based on the unconstrained frequency</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">    uncertainties using a simple weighted average.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">    The base frequency&#39;s uncertainty is calculated as:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">    σ_h1 = (∑ n^2/σ_fn^2)^(-1/2)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">    The other uncertainties follow as:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">    σ_hn = n * σ_h1</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">    Parameters</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">    ----------</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="sd">    sigma_f: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">        Uncertainty in the frequency for each sinusoid.</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">    h_base: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">        Indices of the base frequencies in f_n for each of f_n.</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">    h_mult: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">        Harmonic multiplier of the base frequency for each of f_n.</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">    Returns</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">    -------</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">    numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">        Uncertainty in the harmonic frequencies.</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>    <span class="c1"># calculate the base frequency uncertainty</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>    <span class="n">sigma_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sigma_f</span><span class="p">))</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>    <span class="k">for</span> <span class="n">i_base</span> <span class="ow">in</span> <span class="n">h_base</span><span class="p">[</span><span class="n">h_mult</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="n">h_series</span> <span class="o">=</span> <span class="n">h_base</span> <span class="o">==</span> <span class="n">i_base</span>  <span class="c1"># select one harmonic series at a time</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>        <span class="n">sigma_h</span><span class="p">[</span><span class="n">h_series</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h_mult</span><span class="p">[</span><span class="n">h_series</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sigma_f</span><span class="p">[</span><span class="n">h_series</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>    <span class="c1"># multiply by the harmonic number</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>    <span class="n">sigma_h</span> <span class="o">*=</span> <span class="n">h_mult</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>    <span class="k">return</span> <span class="n">sigma_h</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="k">def</span><span class="w"> </span><span class="nf">formal_uncertainties</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">flux_err</span><span class="p">,</span> <span class="n">a_n</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the corrected uncorrelated (formal) uncertainties for the extracted</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">    parameters (constant, slope, frequencies, amplitudes and phases).</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">    Harmonics are not taken into account.</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">    Parameters</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">    ----------</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">    time: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">        Timestamps of the time series</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">    residuals: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">        Residual is flux - model</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a><span class="sd">    flux_err: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">        Errors in the measurement values</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">    a_n: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="sd">        The amplitudes of a number of sine waves</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">    Returns</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">    -------</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a><span class="sd">    tuple</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a><span class="sd">        A tuple containing the following elements:</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">        sigma_const: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">            Uncertainty in the constant for each sector</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">        sigma_slope: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a><span class="sd">            Uncertainty in the slope for each sector</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">        sigma_f: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a><span class="sd">            Uncertainty in the frequency for each sine wave</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a><span class="sd">        sigma_a: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="sd">            Uncertainty in the amplitude for each sine wave (these are identical)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="sd">        sigma_ph: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">            Uncertainty in the phase for each sine wave</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a><span class="sd">    Notes</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">    -----</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">    As in Aerts 2021, https://ui.adsabs.harvard.edu/abs/2021RvMP...93a5001A/abstract</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">    The sigma value in the formulae is approximated by taking the maximum of the</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="sd">    standard deviation of the residuals and the standard error of the minimum data error.</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">    Errors in const and slope:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">    https://pages.mtu.edu/~fmorriso/cm3215/UncertaintySlopeInterceptOfLeastSquaresFit.pdf</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>    <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>    <span class="n">n_param</span> <span class="o">=</span> <span class="n">n_parameters</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_n</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># number of parameters in the model</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>    <span class="n">n_dof</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_data</span> <span class="o">-</span> <span class="n">n_param</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># degrees of freedom</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>    <span class="c1"># calculate the standard deviation of the residuals</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">std_unb</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">n_dof</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>    <span class="c1"># calculate the standard error based on the smallest data error</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>    <span class="n">ste</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flux_err</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>    <span class="c1"># take the maximum of the standard deviation and standard error as sigma N</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>    <span class="n">sigma_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">ste</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>    <span class="c1"># calculate the D factor (square root of the average number of consecutive data points of the same sign)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>    <span class="n">positive</span> <span class="o">=</span> <span class="p">(</span><span class="n">residuals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>    <span class="n">zero_crossings</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">positive</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">positive</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)]</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>    <span class="n">sss_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">zero_crossings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_data</span><span class="p">])))</span>  <span class="c1"># same-sign sequence indices</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>    <span class="n">d_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sss_i</span><span class="p">)))</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>    <span class="c1"># uncertainty formulae for sinusoids</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>    <span class="n">sigma_f</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>    <span class="n">sigma_ph</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span> <span class="o">/</span> <span class="n">a_n</span>  <span class="c1"># times 2 pi w.r.t. the paper</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>    <span class="c1"># make an array of sigma_a (these are the same)</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_n</span><span class="p">),</span> <span class="n">sigma_a</span><span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>    <span class="c1"># linear regression uncertainties</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>    <span class="n">sigma_const</span><span class="p">,</span> <span class="n">sigma_slope</span> <span class="o">=</span> <span class="n">formal_uncertainties_linear</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>    <span class="k">return</span> <span class="n">sigma_const</span><span class="p">,</span> <span class="n">sigma_slope</span><span class="p">,</span> <span class="n">sigma_f</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_ph</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a><span class="k">def</span><span class="w"> </span><span class="nf">linear_regression_uncertainty_ephem</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">p_orb</span><span class="p">,</span> <span class="n">sigma_t</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the linear regression errors on period and t_zero</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a><span class="sd">    Parameters</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a><span class="sd">    ---------</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a><span class="sd">    time: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a><span class="sd">        Timestamps of the time series.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a><span class="sd">    p_orb: float</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a><span class="sd">        Orbital period in days.</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a><span class="sd">    sigma_t: float</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a><span class="sd">        Error in the individual time measurements.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a><span class="sd">    Returns</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a><span class="sd">    -------</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a><span class="sd">    tuple</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a><span class="sd">        A tuple containing the following elements:</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a><span class="sd">        p_err: float</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a><span class="sd">            Error in the period.</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a><span class="sd">        t_err: float</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a><span class="sd">            Error in t_zero.</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="sd">        p_t_corr: float</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a><span class="sd">            Covariance between the period and t_zero.</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a><span class="sd">    Notes</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a><span class="sd">    -----</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="sd">    The number of eclipses, computed from the period and</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a><span class="sd">    time base, is taken to be a contiguous set.</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a><span class="sd">    var_matrix:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a><span class="sd">    [[std[0]**2          , std[0]*std[1]*corr],</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="sd">     [std[0]*std[1]*corr,           std[1]**2]]</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>    <span class="c1"># number of observed eclipses (technically contiguous)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">//</span> <span class="n">p_orb</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>    <span class="c1"># the arrays</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># &#39;time&#39; points</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># &#39;positive measurement&#39;</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>    <span class="c1"># remove points in gaps</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>    <span class="n">gaps</span> <span class="o">=</span> <span class="n">mark_gaps</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">min_gap</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_between</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">p_orb</span><span class="p">,</span> <span class="n">gaps</span><span class="p">)</span>  <span class="c1"># convert x to time domain</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">n</span><span class="o">//</span><span class="mi">2</span>  <span class="c1"># also centre the time for minimal correlation</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>    <span class="c1"># M</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>    <span class="c1"># M^-1</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>    <span class="n">matrix_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>  <span class="c1"># inverse (of a general matrix)</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>    <span class="c1"># M^-1 S M^-1^T, S unit matrix times some sigma (no covariance in the data)</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>    <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">matrix_inv</span> <span class="o">@</span> <span class="n">matrix_inv</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>    <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">var_matrix</span> <span class="o">*</span> <span class="n">sigma_t</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>    <span class="c1"># errors in the period and t_zero</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>    <span class="n">p_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>    <span class="n">t_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>    <span class="n">p_t_corr</span> <span class="o">=</span> <span class="n">var_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">t_err</span> <span class="o">*</span> <span class="n">p_err</span><span class="p">)</span>  <span class="c1"># or [1, 0]</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>    <span class="k">return</span> <span class="n">p_err</span><span class="p">,</span> <span class="n">t_err</span><span class="p">,</span> <span class="n">p_t_corr</span>
</span></pre></div>


            </section>
                <section id="config">
                    <div class="attr variable">
            <span class="name">config</span>        =
<span class="default_value">&lt;<a href="../config/config.html#Config">star_shine.config.config.Config</a> object&gt;</span>

        
    </div>
    <a class="headerlink" href="#config"></a>
    
    

                </section>
                <section id="datetime_formatted">
                            <input id="datetime_formatted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">datetime_formatted</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="datetime_formatted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#datetime_formatted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="datetime_formatted-18"><a href="#datetime_formatted-18"><span class="linenos">18</span></a><span class="k">def</span><span class="w"> </span><span class="nf">datetime_formatted</span><span class="p">():</span>
</span><span id="datetime_formatted-19"><a href="#datetime_formatted-19"><span class="linenos">19</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return datetime string without microseconds.</span>
</span><span id="datetime_formatted-20"><a href="#datetime_formatted-20"><span class="linenos">20</span></a>
</span><span id="datetime_formatted-21"><a href="#datetime_formatted-21"><span class="linenos">21</span></a><span class="sd">    Returns</span>
</span><span id="datetime_formatted-22"><a href="#datetime_formatted-22"><span class="linenos">22</span></a><span class="sd">    -------</span>
</span><span id="datetime_formatted-23"><a href="#datetime_formatted-23"><span class="linenos">23</span></a><span class="sd">    str</span>
</span><span id="datetime_formatted-24"><a href="#datetime_formatted-24"><span class="linenos">24</span></a><span class="sd">        Date and time without microseconds</span>
</span><span id="datetime_formatted-25"><a href="#datetime_formatted-25"><span class="linenos">25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="datetime_formatted-26"><a href="#datetime_formatted-26"><span class="linenos">26</span></a>    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="datetime_formatted-27"><a href="#datetime_formatted-27"><span class="linenos">27</span></a>    <span class="n">dt_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span id="datetime_formatted-28"><a href="#datetime_formatted-28"><span class="linenos">28</span></a>
</span><span id="datetime_formatted-29"><a href="#datetime_formatted-29"><span class="linenos">29</span></a>    <span class="k">return</span> <span class="n">dt_str</span>
</span></pre></div>


            <div class="docstring"><p>Return datetime string without microseconds.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: Date and time without microseconds</li>
</ul>
</div>


                </section>
                <section id="decimal_figures">
                            <input id="decimal_figures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">decimal_figures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">n_sf</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="decimal_figures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#decimal_figures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="decimal_figures-32"><a href="#decimal_figures-32"><span class="linenos">32</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="decimal_figures-33"><a href="#decimal_figures-33"><span class="linenos">33</span></a><span class="k">def</span><span class="w"> </span><span class="nf">decimal_figures</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_sf</span><span class="p">):</span>
</span><span id="decimal_figures-34"><a href="#decimal_figures-34"><span class="linenos">34</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the number of decimal figures to print given a target</span>
</span><span id="decimal_figures-35"><a href="#decimal_figures-35"><span class="linenos">35</span></a><span class="sd">    number of significant figures</span>
</span><span id="decimal_figures-36"><a href="#decimal_figures-36"><span class="linenos">36</span></a>
</span><span id="decimal_figures-37"><a href="#decimal_figures-37"><span class="linenos">37</span></a><span class="sd">    Parameters</span>
</span><span id="decimal_figures-38"><a href="#decimal_figures-38"><span class="linenos">38</span></a><span class="sd">    ----------</span>
</span><span id="decimal_figures-39"><a href="#decimal_figures-39"><span class="linenos">39</span></a><span class="sd">    x: float</span>
</span><span id="decimal_figures-40"><a href="#decimal_figures-40"><span class="linenos">40</span></a><span class="sd">        Value to determine the number of decimals for.</span>
</span><span id="decimal_figures-41"><a href="#decimal_figures-41"><span class="linenos">41</span></a><span class="sd">    n_sf: int</span>
</span><span id="decimal_figures-42"><a href="#decimal_figures-42"><span class="linenos">42</span></a><span class="sd">        Number of significant figures to compute.</span>
</span><span id="decimal_figures-43"><a href="#decimal_figures-43"><span class="linenos">43</span></a>
</span><span id="decimal_figures-44"><a href="#decimal_figures-44"><span class="linenos">44</span></a><span class="sd">    Returns</span>
</span><span id="decimal_figures-45"><a href="#decimal_figures-45"><span class="linenos">45</span></a><span class="sd">    -------</span>
</span><span id="decimal_figures-46"><a href="#decimal_figures-46"><span class="linenos">46</span></a><span class="sd">    int</span>
</span><span id="decimal_figures-47"><a href="#decimal_figures-47"><span class="linenos">47</span></a><span class="sd">        Number of decimal places to round to.</span>
</span><span id="decimal_figures-48"><a href="#decimal_figures-48"><span class="linenos">48</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="decimal_figures-49"><a href="#decimal_figures-49"><span class="linenos">49</span></a>    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="decimal_figures-50"><a href="#decimal_figures-50"><span class="linenos">50</span></a>        <span class="n">decimals</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_sf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
</span><span id="decimal_figures-51"><a href="#decimal_figures-51"><span class="linenos">51</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="decimal_figures-52"><a href="#decimal_figures-52"><span class="linenos">52</span></a>        <span class="n">decimals</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="decimal_figures-53"><a href="#decimal_figures-53"><span class="linenos">53</span></a>
</span><span id="decimal_figures-54"><a href="#decimal_figures-54"><span class="linenos">54</span></a>    <span class="k">return</span> <span class="n">decimals</span>
</span></pre></div>


            <div class="docstring"><p>Determine the number of decimal figures to print given a target
number of significant figures</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (float):
Value to determine the number of decimals for.</li>
<li><strong>n_sf</strong> (int):
Number of significant figures to compute.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>int</strong>: Number of decimal places to round to.</li>
</ul>
</div>


                </section>
                <section id="float_to_str_numba">
                            <input id="float_to_str_numba-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">float_to_str_numba</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">dec</span><span class="o">=</span><span class="mi">2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="float_to_str_numba-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#float_to_str_numba"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="float_to_str_numba-57"><a href="#float_to_str_numba-57"><span class="linenos">57</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="float_to_str_numba-58"><a href="#float_to_str_numba-58"><span class="linenos">58</span></a><span class="k">def</span><span class="w"> </span><span class="nf">float_to_str_numba</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="float_to_str_numba-59"><a href="#float_to_str_numba-59"><span class="linenos">59</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert float to string for Numba up to some decimal place</span>
</span><span id="float_to_str_numba-60"><a href="#float_to_str_numba-60"><span class="linenos">60</span></a><span class="sd">    </span>
</span><span id="float_to_str_numba-61"><a href="#float_to_str_numba-61"><span class="linenos">61</span></a><span class="sd">    Parameters</span>
</span><span id="float_to_str_numba-62"><a href="#float_to_str_numba-62"><span class="linenos">62</span></a><span class="sd">    ----------</span>
</span><span id="float_to_str_numba-63"><a href="#float_to_str_numba-63"><span class="linenos">63</span></a><span class="sd">    x: float</span>
</span><span id="float_to_str_numba-64"><a href="#float_to_str_numba-64"><span class="linenos">64</span></a><span class="sd">        Value to convert</span>
</span><span id="float_to_str_numba-65"><a href="#float_to_str_numba-65"><span class="linenos">65</span></a><span class="sd">    dec: int</span>
</span><span id="float_to_str_numba-66"><a href="#float_to_str_numba-66"><span class="linenos">66</span></a><span class="sd">        Number of decimals (be careful with large numbers here)</span>
</span><span id="float_to_str_numba-67"><a href="#float_to_str_numba-67"><span class="linenos">67</span></a><span class="sd">    </span>
</span><span id="float_to_str_numba-68"><a href="#float_to_str_numba-68"><span class="linenos">68</span></a><span class="sd">    Returns</span>
</span><span id="float_to_str_numba-69"><a href="#float_to_str_numba-69"><span class="linenos">69</span></a><span class="sd">    -------</span>
</span><span id="float_to_str_numba-70"><a href="#float_to_str_numba-70"><span class="linenos">70</span></a><span class="sd">    str</span>
</span><span id="float_to_str_numba-71"><a href="#float_to_str_numba-71"><span class="linenos">71</span></a><span class="sd">        String with the value x</span>
</span><span id="float_to_str_numba-72"><a href="#float_to_str_numba-72"><span class="linenos">72</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="float_to_str_numba-73"><a href="#float_to_str_numba-73"><span class="linenos">73</span></a>    <span class="n">x_round</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
</span><span id="float_to_str_numba-74"><a href="#float_to_str_numba-74"><span class="linenos">74</span></a>    <span class="n">x_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_round</span><span class="p">)</span>
</span><span id="float_to_str_numba-75"><a href="#float_to_str_numba-75"><span class="linenos">75</span></a>    <span class="n">x_dec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x_round</span> <span class="o">-</span> <span class="n">x_int</span><span class="p">,</span> <span class="n">dec</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">dec</span><span class="p">)</span>
</span><span id="float_to_str_numba-76"><a href="#float_to_str_numba-76"><span class="linenos">76</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_int</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_dec</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
</span><span id="float_to_str_numba-77"><a href="#float_to_str_numba-77"><span class="linenos">77</span></a>
</span><span id="float_to_str_numba-78"><a href="#float_to_str_numba-78"><span class="linenos">78</span></a>    <span class="k">return</span> <span class="n">s</span>
</span></pre></div>


            <div class="docstring"><p>Convert float to string for Numba up to some decimal place</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (float):
Value to convert</li>
<li><strong>dec</strong> (int):
Number of decimals (be careful with large numbers here)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: String with the value x</li>
</ul>
</div>


                </section>
                <section id="float_to_str_scientific">
                            <input id="float_to_str_scientific-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">float_to_str_scientific</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">x_err</span>, </span><span class="param"><span class="n">error</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">brackets</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="float_to_str_scientific-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#float_to_str_scientific"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="float_to_str_scientific-81"><a href="#float_to_str_scientific-81"><span class="linenos"> 81</span></a><span class="k">def</span><span class="w"> </span><span class="nf">float_to_str_scientific</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_err</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">brackets</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="float_to_str_scientific-82"><a href="#float_to_str_scientific-82"><span class="linenos"> 82</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Conversion of a number with an error margin to string in scientific notation.</span>
</span><span id="float_to_str_scientific-83"><a href="#float_to_str_scientific-83"><span class="linenos"> 83</span></a>
</span><span id="float_to_str_scientific-84"><a href="#float_to_str_scientific-84"><span class="linenos"> 84</span></a><span class="sd">    Uses two significant figures by default as no distinction is made between having a 1, 2 or higher number</span>
</span><span id="float_to_str_scientific-85"><a href="#float_to_str_scientific-85"><span class="linenos"> 85</span></a><span class="sd">    in the error value.</span>
</span><span id="float_to_str_scientific-86"><a href="#float_to_str_scientific-86"><span class="linenos"> 86</span></a>
</span><span id="float_to_str_scientific-87"><a href="#float_to_str_scientific-87"><span class="linenos"> 87</span></a><span class="sd">    Parameters</span>
</span><span id="float_to_str_scientific-88"><a href="#float_to_str_scientific-88"><span class="linenos"> 88</span></a><span class="sd">    ----------</span>
</span><span id="float_to_str_scientific-89"><a href="#float_to_str_scientific-89"><span class="linenos"> 89</span></a><span class="sd">    x: float</span>
</span><span id="float_to_str_scientific-90"><a href="#float_to_str_scientific-90"><span class="linenos"> 90</span></a><span class="sd">        Value to determine the number of decimals for.</span>
</span><span id="float_to_str_scientific-91"><a href="#float_to_str_scientific-91"><span class="linenos"> 91</span></a><span class="sd">    x_err: float</span>
</span><span id="float_to_str_scientific-92"><a href="#float_to_str_scientific-92"><span class="linenos"> 92</span></a><span class="sd">        Value to determine the number of decimals for.</span>
</span><span id="float_to_str_scientific-93"><a href="#float_to_str_scientific-93"><span class="linenos"> 93</span></a><span class="sd">    error: bool, optional</span>
</span><span id="float_to_str_scientific-94"><a href="#float_to_str_scientific-94"><span class="linenos"> 94</span></a><span class="sd">        Include the error value.</span>
</span><span id="float_to_str_scientific-95"><a href="#float_to_str_scientific-95"><span class="linenos"> 95</span></a><span class="sd">    brackets: bool, optional</span>
</span><span id="float_to_str_scientific-96"><a href="#float_to_str_scientific-96"><span class="linenos"> 96</span></a><span class="sd">        Place the error value in brackets.</span>
</span><span id="float_to_str_scientific-97"><a href="#float_to_str_scientific-97"><span class="linenos"> 97</span></a>
</span><span id="float_to_str_scientific-98"><a href="#float_to_str_scientific-98"><span class="linenos"> 98</span></a><span class="sd">    Returns</span>
</span><span id="float_to_str_scientific-99"><a href="#float_to_str_scientific-99"><span class="linenos"> 99</span></a><span class="sd">    -------</span>
</span><span id="float_to_str_scientific-100"><a href="#float_to_str_scientific-100"><span class="linenos">100</span></a><span class="sd">    str</span>
</span><span id="float_to_str_scientific-101"><a href="#float_to_str_scientific-101"><span class="linenos">101</span></a><span class="sd">        Formatted string conversion.</span>
</span><span id="float_to_str_scientific-102"><a href="#float_to_str_scientific-102"><span class="linenos">102</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="float_to_str_scientific-103"><a href="#float_to_str_scientific-103"><span class="linenos">103</span></a>    <span class="c1"># determine the decimal places to round to</span>
</span><span id="float_to_str_scientific-104"><a href="#float_to_str_scientific-104"><span class="linenos">104</span></a>    <span class="n">rnd_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">decimal_figures</span><span class="p">(</span><span class="n">x_err</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">decimal_figures</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="float_to_str_scientific-105"><a href="#float_to_str_scientific-105"><span class="linenos">105</span></a>
</span><span id="float_to_str_scientific-106"><a href="#float_to_str_scientific-106"><span class="linenos">106</span></a>    <span class="c1"># format the error value</span>
</span><span id="float_to_str_scientific-107"><a href="#float_to_str_scientific-107"><span class="linenos">107</span></a>    <span class="k">if</span> <span class="n">brackets</span><span class="p">:</span>
</span><span id="float_to_str_scientific-108"><a href="#float_to_str_scientific-108"><span class="linenos">108</span></a>        <span class="n">err_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="se">\u00B1</span><span class="si">{</span><span class="n">x_err</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">rnd_x</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="float_to_str_scientific-109"><a href="#float_to_str_scientific-109"><span class="linenos">109</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="float_to_str_scientific-110"><a href="#float_to_str_scientific-110"><span class="linenos">110</span></a>        <span class="n">err_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u00B1</span><span class="s2"> </span><span class="si">{</span><span class="n">x_err</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">rnd_x</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="float_to_str_scientific-111"><a href="#float_to_str_scientific-111"><span class="linenos">111</span></a>
</span><span id="float_to_str_scientific-112"><a href="#float_to_str_scientific-112"><span class="linenos">112</span></a>    <span class="c1"># format the rest of the string</span>
</span><span id="float_to_str_scientific-113"><a href="#float_to_str_scientific-113"><span class="linenos">113</span></a>    <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
</span><span id="float_to_str_scientific-114"><a href="#float_to_str_scientific-114"><span class="linenos">114</span></a>        <span class="n">number_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">rnd_x</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">err_str</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="float_to_str_scientific-115"><a href="#float_to_str_scientific-115"><span class="linenos">115</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="float_to_str_scientific-116"><a href="#float_to_str_scientific-116"><span class="linenos">116</span></a>        <span class="n">number_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">rnd_x</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="float_to_str_scientific-117"><a href="#float_to_str_scientific-117"><span class="linenos">117</span></a>
</span><span id="float_to_str_scientific-118"><a href="#float_to_str_scientific-118"><span class="linenos">118</span></a>    <span class="k">return</span> <span class="n">number_str</span>
</span></pre></div>


            <div class="docstring"><p>Conversion of a number with an error margin to string in scientific notation.</p>

<p>Uses two significant figures by default as no distinction is made between having a 1, 2 or higher number
in the error value.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (float):
Value to determine the number of decimals for.</li>
<li><strong>x_err</strong> (float):
Value to determine the number of decimals for.</li>
<li><strong>error</strong> (bool, optional):
Include the error value.</li>
<li><strong>brackets</strong> (bool, optional):
Place the error value in brackets.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: Formatted string conversion.</li>
</ul>
</div>


                </section>
                <section id="weighted_mean">
                            <input id="weighted_mean-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">weighted_mean</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">w</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="weighted_mean-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#weighted_mean"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="weighted_mean-121"><a href="#weighted_mean-121"><span class="linenos">121</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="weighted_mean-122"><a href="#weighted_mean-122"><span class="linenos">122</span></a><span class="k">def</span><span class="w"> </span><span class="nf">weighted_mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
</span><span id="weighted_mean-123"><a href="#weighted_mean-123"><span class="linenos">123</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Weighted mean since Numba doesn&#39;t support numpy.average</span>
</span><span id="weighted_mean-124"><a href="#weighted_mean-124"><span class="linenos">124</span></a><span class="sd">    </span>
</span><span id="weighted_mean-125"><a href="#weighted_mean-125"><span class="linenos">125</span></a><span class="sd">    Parameters</span>
</span><span id="weighted_mean-126"><a href="#weighted_mean-126"><span class="linenos">126</span></a><span class="sd">    ----------</span>
</span><span id="weighted_mean-127"><a href="#weighted_mean-127"><span class="linenos">127</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="weighted_mean-128"><a href="#weighted_mean-128"><span class="linenos">128</span></a><span class="sd">        Values to calculate the mean over</span>
</span><span id="weighted_mean-129"><a href="#weighted_mean-129"><span class="linenos">129</span></a><span class="sd">    w: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="weighted_mean-130"><a href="#weighted_mean-130"><span class="linenos">130</span></a><span class="sd">        Weights corresponding to each value</span>
</span><span id="weighted_mean-131"><a href="#weighted_mean-131"><span class="linenos">131</span></a><span class="sd">    </span>
</span><span id="weighted_mean-132"><a href="#weighted_mean-132"><span class="linenos">132</span></a><span class="sd">    Returns</span>
</span><span id="weighted_mean-133"><a href="#weighted_mean-133"><span class="linenos">133</span></a><span class="sd">    -------</span>
</span><span id="weighted_mean-134"><a href="#weighted_mean-134"><span class="linenos">134</span></a><span class="sd">    float</span>
</span><span id="weighted_mean-135"><a href="#weighted_mean-135"><span class="linenos">135</span></a><span class="sd">        Mean of x weighted by w</span>
</span><span id="weighted_mean-136"><a href="#weighted_mean-136"><span class="linenos">136</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="weighted_mean-137"><a href="#weighted_mean-137"><span class="linenos">137</span></a>    <span class="n">w_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="weighted_mean-138"><a href="#weighted_mean-138"><span class="linenos">138</span></a>
</span><span id="weighted_mean-139"><a href="#weighted_mean-139"><span class="linenos">139</span></a>    <span class="k">return</span> <span class="n">w_mean</span>
</span></pre></div>


            <div class="docstring"><p>Weighted mean since Numba doesn't support numpy.average</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (numpy.ndarray[Any, dtype[float]]):
Values to calculate the mean over</li>
<li><strong>w</strong> (numpy.ndarray[Any, dtype[float]]):
Weights corresponding to each value</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: Mean of x weighted by w</li>
</ul>
</div>


                </section>
                <section id="std_unb">
                            <input id="std_unb-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">std_unb</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">n</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="std_unb-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#std_unb"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="std_unb-142"><a href="#std_unb-142"><span class="linenos">142</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="std_unb-143"><a href="#std_unb-143"><span class="linenos">143</span></a><span class="k">def</span><span class="w"> </span><span class="nf">std_unb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="std_unb-144"><a href="#std_unb-144"><span class="linenos">144</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Unbiased standard deviation</span>
</span><span id="std_unb-145"><a href="#std_unb-145"><span class="linenos">145</span></a>
</span><span id="std_unb-146"><a href="#std_unb-146"><span class="linenos">146</span></a><span class="sd">    Parameters</span>
</span><span id="std_unb-147"><a href="#std_unb-147"><span class="linenos">147</span></a><span class="sd">    ----------</span>
</span><span id="std_unb-148"><a href="#std_unb-148"><span class="linenos">148</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="std_unb-149"><a href="#std_unb-149"><span class="linenos">149</span></a><span class="sd">        Values to calculate the std over</span>
</span><span id="std_unb-150"><a href="#std_unb-150"><span class="linenos">150</span></a><span class="sd">    n: int</span>
</span><span id="std_unb-151"><a href="#std_unb-151"><span class="linenos">151</span></a><span class="sd">        Number of degrees of freedom</span>
</span><span id="std_unb-152"><a href="#std_unb-152"><span class="linenos">152</span></a>
</span><span id="std_unb-153"><a href="#std_unb-153"><span class="linenos">153</span></a><span class="sd">    Returns</span>
</span><span id="std_unb-154"><a href="#std_unb-154"><span class="linenos">154</span></a><span class="sd">    -------</span>
</span><span id="std_unb-155"><a href="#std_unb-155"><span class="linenos">155</span></a><span class="sd">    float</span>
</span><span id="std_unb-156"><a href="#std_unb-156"><span class="linenos">156</span></a><span class="sd">        Unbiased standard deviation</span>
</span><span id="std_unb-157"><a href="#std_unb-157"><span class="linenos">157</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="std_unb-158"><a href="#std_unb-158"><span class="linenos">158</span></a>    <span class="n">residuals</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="std_unb-159"><a href="#std_unb-159"><span class="linenos">159</span></a>
</span><span id="std_unb-160"><a href="#std_unb-160"><span class="linenos">160</span></a>    <span class="c1"># tested to be faster in numba than np.sum(x**2)</span>
</span><span id="std_unb-161"><a href="#std_unb-161"><span class="linenos">161</span></a>    <span class="n">sum_r_2</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="std_unb-162"><a href="#std_unb-162"><span class="linenos">162</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)):</span>
</span><span id="std_unb-163"><a href="#std_unb-163"><span class="linenos">163</span></a>        <span class="n">sum_r_2</span> <span class="o">+=</span> <span class="n">residuals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span id="std_unb-164"><a href="#std_unb-164"><span class="linenos">164</span></a>
</span><span id="std_unb-165"><a href="#std_unb-165"><span class="linenos">165</span></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sum_r_2</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># unbiased standard deviation of the residuals</span>
</span><span id="std_unb-166"><a href="#std_unb-166"><span class="linenos">166</span></a>
</span><span id="std_unb-167"><a href="#std_unb-167"><span class="linenos">167</span></a>    <span class="k">return</span> <span class="n">std</span>
</span></pre></div>


            <div class="docstring"><p>Unbiased standard deviation</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (numpy.ndarray[Any, dtype[float]]):
Values to calculate the std over</li>
<li><strong>n</strong> (int):
Number of degrees of freedom</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: Unbiased standard deviation</li>
</ul>
</div>


                </section>
                <section id="consecutive_subsets">
                            <input id="consecutive_subsets-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">consecutive_subsets</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="consecutive_subsets-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#consecutive_subsets"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="consecutive_subsets-170"><a href="#consecutive_subsets-170"><span class="linenos">170</span></a><span class="k">def</span><span class="w"> </span><span class="nf">consecutive_subsets</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="consecutive_subsets-171"><a href="#consecutive_subsets-171"><span class="linenos">171</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates all consecutive subsets of the given list.</span>
</span><span id="consecutive_subsets-172"><a href="#consecutive_subsets-172"><span class="linenos">172</span></a>
</span><span id="consecutive_subsets-173"><a href="#consecutive_subsets-173"><span class="linenos">173</span></a><span class="sd">    Parameters</span>
</span><span id="consecutive_subsets-174"><a href="#consecutive_subsets-174"><span class="linenos">174</span></a><span class="sd">    ----------</span>
</span><span id="consecutive_subsets-175"><a href="#consecutive_subsets-175"><span class="linenos">175</span></a><span class="sd">    x: list[Any], numpy.ndarray[Any, dtype[Any]]</span>
</span><span id="consecutive_subsets-176"><a href="#consecutive_subsets-176"><span class="linenos">176</span></a><span class="sd">        A list of values.</span>
</span><span id="consecutive_subsets-177"><a href="#consecutive_subsets-177"><span class="linenos">177</span></a>
</span><span id="consecutive_subsets-178"><a href="#consecutive_subsets-178"><span class="linenos">178</span></a><span class="sd">    Returns</span>
</span><span id="consecutive_subsets-179"><a href="#consecutive_subsets-179"><span class="linenos">179</span></a><span class="sd">    -------</span>
</span><span id="consecutive_subsets-180"><a href="#consecutive_subsets-180"><span class="linenos">180</span></a><span class="sd">    list</span>
</span><span id="consecutive_subsets-181"><a href="#consecutive_subsets-181"><span class="linenos">181</span></a><span class="sd">        The list of consecutive subsets ordered by size and with length two or more.</span>
</span><span id="consecutive_subsets-182"><a href="#consecutive_subsets-182"><span class="linenos">182</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="consecutive_subsets-183"><a href="#consecutive_subsets-183"><span class="linenos">183</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="consecutive_subsets-184"><a href="#consecutive_subsets-184"><span class="linenos">184</span></a>
</span><span id="consecutive_subsets-185"><a href="#consecutive_subsets-185"><span class="linenos">185</span></a>    <span class="c1"># create the subsets from largest to smallest</span>
</span><span id="consecutive_subsets-186"><a href="#consecutive_subsets-186"><span class="linenos">186</span></a>    <span class="n">subsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">p1</span><span class="p">:</span><span class="n">p1</span> <span class="o">+</span> <span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="consecutive_subsets-187"><a href="#consecutive_subsets-187"><span class="linenos">187</span></a>
</span><span id="consecutive_subsets-188"><a href="#consecutive_subsets-188"><span class="linenos">188</span></a>    <span class="k">return</span> <span class="n">subsets</span>
</span></pre></div>


            <div class="docstring"><p>Creates all consecutive subsets of the given list.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (list[Any], numpy.ndarray[Any, dtype[Any]]):
A list of values.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list</strong>: The list of consecutive subsets ordered by size and with length two or more.</li>
</ul>
</div>


                </section>
                <section id="adjust_indices_removed">
                            <input id="adjust_indices_removed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adjust_indices_removed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">removed</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="adjust_indices_removed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#adjust_indices_removed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="adjust_indices_removed-191"><a href="#adjust_indices_removed-191"><span class="linenos">191</span></a><span class="k">def</span><span class="w"> </span><span class="nf">adjust_indices_removed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">removed</span><span class="p">):</span>
</span><span id="adjust_indices_removed-192"><a href="#adjust_indices_removed-192"><span class="linenos">192</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjusts the indices in `x` to account for removals.</span>
</span><span id="adjust_indices_removed-193"><a href="#adjust_indices_removed-193"><span class="linenos">193</span></a>
</span><span id="adjust_indices_removed-194"><a href="#adjust_indices_removed-194"><span class="linenos">194</span></a><span class="sd">    If y_reduced=np.delete(y, removed), and x are indices indicating items in y, this function gives</span>
</span><span id="adjust_indices_removed-195"><a href="#adjust_indices_removed-195"><span class="linenos">195</span></a><span class="sd">    the indices x_adj that indicate the same items in y_reduced. Assumes that none of the removed items</span>
</span><span id="adjust_indices_removed-196"><a href="#adjust_indices_removed-196"><span class="linenos">196</span></a><span class="sd">    are indicated by indices in x.</span>
</span><span id="adjust_indices_removed-197"><a href="#adjust_indices_removed-197"><span class="linenos">197</span></a>
</span><span id="adjust_indices_removed-198"><a href="#adjust_indices_removed-198"><span class="linenos">198</span></a><span class="sd">    Parameters</span>
</span><span id="adjust_indices_removed-199"><a href="#adjust_indices_removed-199"><span class="linenos">199</span></a><span class="sd">    ----------</span>
</span><span id="adjust_indices_removed-200"><a href="#adjust_indices_removed-200"><span class="linenos">200</span></a><span class="sd">    x: iterable[int], numpy.ndarray[Any, dtype[int]]</span>
</span><span id="adjust_indices_removed-201"><a href="#adjust_indices_removed-201"><span class="linenos">201</span></a><span class="sd">        A list of indices that slice another array, y.</span>
</span><span id="adjust_indices_removed-202"><a href="#adjust_indices_removed-202"><span class="linenos">202</span></a><span class="sd">    removed: iterable[int], numpy.ndarray[Any, dtype[int]]</span>
</span><span id="adjust_indices_removed-203"><a href="#adjust_indices_removed-203"><span class="linenos">203</span></a><span class="sd">        A second list of indices indicating removals from y.</span>
</span><span id="adjust_indices_removed-204"><a href="#adjust_indices_removed-204"><span class="linenos">204</span></a>
</span><span id="adjust_indices_removed-205"><a href="#adjust_indices_removed-205"><span class="linenos">205</span></a><span class="sd">    Returns</span>
</span><span id="adjust_indices_removed-206"><a href="#adjust_indices_removed-206"><span class="linenos">206</span></a><span class="sd">    -------</span>
</span><span id="adjust_indices_removed-207"><a href="#adjust_indices_removed-207"><span class="linenos">207</span></a><span class="sd">    list[int]</span>
</span><span id="adjust_indices_removed-208"><a href="#adjust_indices_removed-208"><span class="linenos">208</span></a><span class="sd">        Adjusted indices that can be used with the reduced y.</span>
</span><span id="adjust_indices_removed-209"><a href="#adjust_indices_removed-209"><span class="linenos">209</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="adjust_indices_removed-210"><a href="#adjust_indices_removed-210"><span class="linenos">210</span></a>    <span class="c1"># adjust the indices</span>
</span><span id="adjust_indices_removed-211"><a href="#adjust_indices_removed-211"><span class="linenos">211</span></a>    <span class="n">x_adj</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">removed</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
</span><span id="adjust_indices_removed-212"><a href="#adjust_indices_removed-212"><span class="linenos">212</span></a>
</span><span id="adjust_indices_removed-213"><a href="#adjust_indices_removed-213"><span class="linenos">213</span></a>    <span class="k">return</span> <span class="n">x_adj</span>
</span></pre></div>


            <div class="docstring"><p>Adjusts the indices in <code>x</code> to account for removals.</p>

<p>If y_reduced=np.delete(y, removed), and x are indices indicating items in y, this function gives
the indices x_adj that indicate the same items in y_reduced. Assumes that none of the removed items
are indicated by indices in x.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (iterable[int], numpy.ndarray[Any, dtype[int]]):
A list of indices that slice another array, y.</li>
<li><strong>removed</strong> (iterable[int], numpy.ndarray[Any, dtype[int]]):
A second list of indices indicating removals from y.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list[int]</strong>: Adjusted indices that can be used with the reduced y.</li>
</ul>
</div>


                </section>
                <section id="find_local_max">
                            <input id="find_local_max-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">find_local_max</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">y</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="find_local_max-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#find_local_max"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="find_local_max-216"><a href="#find_local_max-216"><span class="linenos">216</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="find_local_max-217"><a href="#find_local_max-217"><span class="linenos">217</span></a><span class="k">def</span><span class="w"> </span><span class="nf">find_local_max</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
</span><span id="find_local_max-218"><a href="#find_local_max-218"><span class="linenos">218</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the indeces of the local maxima in `y`.</span>
</span><span id="find_local_max-219"><a href="#find_local_max-219"><span class="linenos">219</span></a>
</span><span id="find_local_max-220"><a href="#find_local_max-220"><span class="linenos">220</span></a><span class="sd">    The array `x` must be sorted in ascending order. This function identifies local maxima in the `y` array</span>
</span><span id="find_local_max-221"><a href="#find_local_max-221"><span class="linenos">221</span></a><span class="sd">    and returns the corresponding indeces.</span>
</span><span id="find_local_max-222"><a href="#find_local_max-222"><span class="linenos">222</span></a>
</span><span id="find_local_max-223"><a href="#find_local_max-223"><span class="linenos">223</span></a><span class="sd">    Parameters</span>
</span><span id="find_local_max-224"><a href="#find_local_max-224"><span class="linenos">224</span></a><span class="sd">    ----------</span>
</span><span id="find_local_max-225"><a href="#find_local_max-225"><span class="linenos">225</span></a><span class="sd">    y: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="find_local_max-226"><a href="#find_local_max-226"><span class="linenos">226</span></a><span class="sd">        1D array of y-values corresponding to the x-values.</span>
</span><span id="find_local_max-227"><a href="#find_local_max-227"><span class="linenos">227</span></a>
</span><span id="find_local_max-228"><a href="#find_local_max-228"><span class="linenos">228</span></a><span class="sd">    Returns</span>
</span><span id="find_local_max-229"><a href="#find_local_max-229"><span class="linenos">229</span></a><span class="sd">    -------</span>
</span><span id="find_local_max-230"><a href="#find_local_max-230"><span class="linenos">230</span></a><span class="sd">    numpy.ndarray[Any, dtype[int]]</span>
</span><span id="find_local_max-231"><a href="#find_local_max-231"><span class="linenos">231</span></a><span class="sd">        Indeces of the `x` values corresponding to the local maxima.</span>
</span><span id="find_local_max-232"><a href="#find_local_max-232"><span class="linenos">232</span></a>
</span><span id="find_local_max-233"><a href="#find_local_max-233"><span class="linenos">233</span></a><span class="sd">    Examples</span>
</span><span id="find_local_max-234"><a href="#find_local_max-234"><span class="linenos">234</span></a><span class="sd">    --------</span>
</span><span id="find_local_max-235"><a href="#find_local_max-235"><span class="linenos">235</span></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
</span><span id="find_local_max-236"><a href="#find_local_max-236"><span class="linenos">236</span></a><span class="sd">    &gt;&gt;&gt; y = np.array([1, 3, 2, 5, 4, 6])</span>
</span><span id="find_local_max-237"><a href="#find_local_max-237"><span class="linenos">237</span></a><span class="sd">    &gt;&gt;&gt; find_local_max(y)</span>
</span><span id="find_local_max-238"><a href="#find_local_max-238"><span class="linenos">238</span></a><span class="sd">    array([1, 3, 5])</span>
</span><span id="find_local_max-239"><a href="#find_local_max-239"><span class="linenos">239</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="find_local_max-240"><a href="#find_local_max-240"><span class="linenos">240</span></a>    <span class="c1"># differenced y</span>
</span><span id="find_local_max-241"><a href="#find_local_max-241"><span class="linenos">241</span></a>    <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="find_local_max-242"><a href="#find_local_max-242"><span class="linenos">242</span></a>
</span><span id="find_local_max-243"><a href="#find_local_max-243"><span class="linenos">243</span></a>    <span class="c1"># sign of difference of y</span>
</span><span id="find_local_max-244"><a href="#find_local_max-244"><span class="linenos">244</span></a>    <span class="n">sign_dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
</span><span id="find_local_max-245"><a href="#find_local_max-245"><span class="linenos">245</span></a>    <span class="n">sign_dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sign_dy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>  <span class="c1"># add 1 and -1 on the ends for maximum finding</span>
</span><span id="find_local_max-246"><a href="#find_local_max-246"><span class="linenos">246</span></a>
</span><span id="find_local_max-247"><a href="#find_local_max-247"><span class="linenos">247</span></a>    <span class="c1"># find the maxima in y</span>
</span><span id="find_local_max-248"><a href="#find_local_max-248"><span class="linenos">248</span></a>    <span class="n">extrema</span> <span class="o">=</span> <span class="n">sign_dy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">sign_dy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># places where the array dy changes sign</span>
</span><span id="find_local_max-249"><a href="#find_local_max-249"><span class="linenos">249</span></a>    <span class="n">maxima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extrema</span><span class="p">))[</span><span class="n">extrema</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># places where y has a maximum</span>
</span><span id="find_local_max-250"><a href="#find_local_max-250"><span class="linenos">250</span></a>
</span><span id="find_local_max-251"><a href="#find_local_max-251"><span class="linenos">251</span></a>    <span class="k">return</span> <span class="n">maxima</span>
</span></pre></div>


            <div class="docstring"><p>Find the indeces of the local maxima in <code>y</code>.</p>

<p>The array <code>x</code> must be sorted in ascending order. This function identifies local maxima in the <code>y</code> array
and returns the corresponding indeces.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>y</strong> (numpy.ndarray[Any, dtype[float]]):
1D array of y-values corresponding to the x-values.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray[Any, dtype[int]]</strong>: Indeces of the <code>x</code> values corresponding to the local maxima.</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">find_local_max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="go">array([1, 3, 5])</span>
</code></pre>
</div>
</div>


                </section>
                <section id="uphill_local_max">
                            <input id="uphill_local_max-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">uphill_local_max</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">x_approx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="uphill_local_max-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#uphill_local_max"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="uphill_local_max-254"><a href="#uphill_local_max-254"><span class="linenos">254</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="uphill_local_max-255"><a href="#uphill_local_max-255"><span class="linenos">255</span></a><span class="k">def</span><span class="w"> </span><span class="nf">uphill_local_max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_approx</span><span class="p">):</span>
</span><span id="uphill_local_max-256"><a href="#uphill_local_max-256"><span class="linenos">256</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the index of the local maximum in `y` uphill from `x_approx`.</span>
</span><span id="uphill_local_max-257"><a href="#uphill_local_max-257"><span class="linenos">257</span></a>
</span><span id="uphill_local_max-258"><a href="#uphill_local_max-258"><span class="linenos">258</span></a><span class="sd">    The array `x` must be sorted in ascending order. This function identifies local maxima in the `y` array</span>
</span><span id="uphill_local_max-259"><a href="#uphill_local_max-259"><span class="linenos">259</span></a><span class="sd">    and returns the index of the `x` value corresponding to the local maximum uphill from `x_approx`.</span>
</span><span id="uphill_local_max-260"><a href="#uphill_local_max-260"><span class="linenos">260</span></a>
</span><span id="uphill_local_max-261"><a href="#uphill_local_max-261"><span class="linenos">261</span></a><span class="sd">    Parameters</span>
</span><span id="uphill_local_max-262"><a href="#uphill_local_max-262"><span class="linenos">262</span></a><span class="sd">    ----------</span>
</span><span id="uphill_local_max-263"><a href="#uphill_local_max-263"><span class="linenos">263</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="uphill_local_max-264"><a href="#uphill_local_max-264"><span class="linenos">264</span></a><span class="sd">        1D array of x-values, which must be sorted in ascending order.</span>
</span><span id="uphill_local_max-265"><a href="#uphill_local_max-265"><span class="linenos">265</span></a><span class="sd">    y: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="uphill_local_max-266"><a href="#uphill_local_max-266"><span class="linenos">266</span></a><span class="sd">        1D array of y-values corresponding to the x-values.</span>
</span><span id="uphill_local_max-267"><a href="#uphill_local_max-267"><span class="linenos">267</span></a><span class="sd">    x_approx: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="uphill_local_max-268"><a href="#uphill_local_max-268"><span class="linenos">268</span></a><span class="sd">        The x-value(s) around which to find the nearest local maximum.</span>
</span><span id="uphill_local_max-269"><a href="#uphill_local_max-269"><span class="linenos">269</span></a>
</span><span id="uphill_local_max-270"><a href="#uphill_local_max-270"><span class="linenos">270</span></a><span class="sd">    Returns</span>
</span><span id="uphill_local_max-271"><a href="#uphill_local_max-271"><span class="linenos">271</span></a><span class="sd">    -------</span>
</span><span id="uphill_local_max-272"><a href="#uphill_local_max-272"><span class="linenos">272</span></a><span class="sd">    numpy.ndarray[Any, dtype[int]]</span>
</span><span id="uphill_local_max-273"><a href="#uphill_local_max-273"><span class="linenos">273</span></a><span class="sd">        Index of the `x` value(s) corresponding to the nearest local maximum to `x_approx`.</span>
</span><span id="uphill_local_max-274"><a href="#uphill_local_max-274"><span class="linenos">274</span></a>
</span><span id="uphill_local_max-275"><a href="#uphill_local_max-275"><span class="linenos">275</span></a><span class="sd">    Examples</span>
</span><span id="uphill_local_max-276"><a href="#uphill_local_max-276"><span class="linenos">276</span></a><span class="sd">    --------</span>
</span><span id="uphill_local_max-277"><a href="#uphill_local_max-277"><span class="linenos">277</span></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
</span><span id="uphill_local_max-278"><a href="#uphill_local_max-278"><span class="linenos">278</span></a><span class="sd">    &gt;&gt;&gt; x = np.array([1, 2, 3, 4, 5, 6])</span>
</span><span id="uphill_local_max-279"><a href="#uphill_local_max-279"><span class="linenos">279</span></a><span class="sd">    &gt;&gt;&gt; y = np.array([1, 3, 2, 5, 4, 6])</span>
</span><span id="uphill_local_max-280"><a href="#uphill_local_max-280"><span class="linenos">280</span></a><span class="sd">    &gt;&gt;&gt; x_approx = np.array([2.4, 4.6])</span>
</span><span id="uphill_local_max-281"><a href="#uphill_local_max-281"><span class="linenos">281</span></a><span class="sd">    &gt;&gt;&gt; uphill_local_max(x, y, x_approx)</span>
</span><span id="uphill_local_max-282"><a href="#uphill_local_max-282"><span class="linenos">282</span></a><span class="sd">    array([1, 3])</span>
</span><span id="uphill_local_max-283"><a href="#uphill_local_max-283"><span class="linenos">283</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="uphill_local_max-284"><a href="#uphill_local_max-284"><span class="linenos">284</span></a>    <span class="c1"># [note] this is find_local_max(y), but since we need sign_dy we do this here</span>
</span><span id="uphill_local_max-285"><a href="#uphill_local_max-285"><span class="linenos">285</span></a>    <span class="c1"># differenced y</span>
</span><span id="uphill_local_max-286"><a href="#uphill_local_max-286"><span class="linenos">286</span></a>    <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="uphill_local_max-287"><a href="#uphill_local_max-287"><span class="linenos">287</span></a>
</span><span id="uphill_local_max-288"><a href="#uphill_local_max-288"><span class="linenos">288</span></a>    <span class="c1"># find the maxima in y</span>
</span><span id="uphill_local_max-289"><a href="#uphill_local_max-289"><span class="linenos">289</span></a>    <span class="n">sign_dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
</span><span id="uphill_local_max-290"><a href="#uphill_local_max-290"><span class="linenos">290</span></a>    <span class="n">sign_dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sign_dy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>  <span class="c1"># add 1 and -1 on the ends for maximum finding</span>
</span><span id="uphill_local_max-291"><a href="#uphill_local_max-291"><span class="linenos">291</span></a>    <span class="n">extrema</span> <span class="o">=</span> <span class="n">sign_dy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">sign_dy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># places where the array dy changes sign</span>
</span><span id="uphill_local_max-292"><a href="#uphill_local_max-292"><span class="linenos">292</span></a>    <span class="n">maxima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extrema</span><span class="p">))[</span><span class="n">extrema</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># places where y has a maximum</span>
</span><span id="uphill_local_max-293"><a href="#uphill_local_max-293"><span class="linenos">293</span></a>
</span><span id="uphill_local_max-294"><a href="#uphill_local_max-294"><span class="linenos">294</span></a>    <span class="c1"># position of x_approx in x (index is point to the right of x_approx)</span>
</span><span id="uphill_local_max-295"><a href="#uphill_local_max-295"><span class="linenos">295</span></a>    <span class="n">pos_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_approx</span><span class="p">)</span>  <span class="c1"># pos_x can be 0 and len(x) but this is ok for sign_dy</span>
</span><span id="uphill_local_max-296"><a href="#uphill_local_max-296"><span class="linenos">296</span></a>
</span><span id="uphill_local_max-297"><a href="#uphill_local_max-297"><span class="linenos">297</span></a>    <span class="c1"># do we need to move left or right to get to the maximum</span>
</span><span id="uphill_local_max-298"><a href="#uphill_local_max-298"><span class="linenos">298</span></a>    <span class="n">left_right</span> <span class="o">=</span> <span class="n">sign_dy</span><span class="p">[</span><span class="n">pos_x</span><span class="p">]</span>  <span class="c1"># negative: left, positive: right</span>
</span><span id="uphill_local_max-299"><a href="#uphill_local_max-299"><span class="linenos">299</span></a>
</span><span id="uphill_local_max-300"><a href="#uphill_local_max-300"><span class="linenos">300</span></a>    <span class="c1"># get the maximum for each x_approx (index is maximum to the right of pos_x)</span>
</span><span id="uphill_local_max-301"><a href="#uphill_local_max-301"><span class="linenos">301</span></a>    <span class="n">pos_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">maxima</span><span class="p">,</span> <span class="n">pos_x</span><span class="p">)</span>
</span><span id="uphill_local_max-302"><a href="#uphill_local_max-302"><span class="linenos">302</span></a>    <span class="c1"># take the maximum on the left for negative slopes</span>
</span><span id="uphill_local_max-303"><a href="#uphill_local_max-303"><span class="linenos">303</span></a>    <span class="n">pos_max</span><span class="p">[</span><span class="n">left_right</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="uphill_local_max-304"><a href="#uphill_local_max-304"><span class="linenos">304</span></a>    <span class="n">x_max</span> <span class="o">=</span> <span class="n">maxima</span><span class="p">[</span><span class="n">pos_max</span><span class="p">]</span>
</span><span id="uphill_local_max-305"><a href="#uphill_local_max-305"><span class="linenos">305</span></a>
</span><span id="uphill_local_max-306"><a href="#uphill_local_max-306"><span class="linenos">306</span></a>    <span class="k">return</span> <span class="n">x_max</span>
</span></pre></div>


            <div class="docstring"><p>Find the index of the local maximum in <code>y</code> uphill from <code>x_approx</code>.</p>

<p>The array <code>x</code> must be sorted in ascending order. This function identifies local maxima in the <code>y</code> array
and returns the index of the <code>x</code> value corresponding to the local maximum uphill from <code>x_approx</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (numpy.ndarray[Any, dtype[float]]):
1D array of x-values, which must be sorted in ascending order.</li>
<li><strong>y</strong> (numpy.ndarray[Any, dtype[float]]):
1D array of y-values corresponding to the x-values.</li>
<li><strong>x_approx</strong> (numpy.ndarray[Any, dtype[float]]):
The x-value(s) around which to find the nearest local maximum.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray[Any, dtype[int]]</strong>: Index of the <code>x</code> value(s) corresponding to the nearest local maximum to <code>x_approx</code>.</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uphill_local_max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_approx</span><span class="p">)</span>
<span class="go">array([1, 3])</span>
</code></pre>
</div>
</div>


                </section>
                <section id="mask_between">
                            <input id="mask_between-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">mask_between</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">locations</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mask_between-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mask_between"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mask_between-309"><a href="#mask_between-309"><span class="linenos">309</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="mask_between-310"><a href="#mask_between-310"><span class="linenos">310</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mask_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
</span><span id="mask_between-311"><a href="#mask_between-311"><span class="linenos">311</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mask out everything except the parts between the given timestamps</span>
</span><span id="mask_between-312"><a href="#mask_between-312"><span class="linenos">312</span></a>
</span><span id="mask_between-313"><a href="#mask_between-313"><span class="linenos">313</span></a><span class="sd">    Parameters</span>
</span><span id="mask_between-314"><a href="#mask_between-314"><span class="linenos">314</span></a><span class="sd">    ----------</span>
</span><span id="mask_between-315"><a href="#mask_between-315"><span class="linenos">315</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="mask_between-316"><a href="#mask_between-316"><span class="linenos">316</span></a><span class="sd">        Time series to be masked.</span>
</span><span id="mask_between-317"><a href="#mask_between-317"><span class="linenos">317</span></a><span class="sd">    locations: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="mask_between-318"><a href="#mask_between-318"><span class="linenos">318</span></a><span class="sd">        Pairs of points in the time series. Everything but the space between points is masked.</span>
</span><span id="mask_between-319"><a href="#mask_between-319"><span class="linenos">319</span></a>
</span><span id="mask_between-320"><a href="#mask_between-320"><span class="linenos">320</span></a><span class="sd">    Returns</span>
</span><span id="mask_between-321"><a href="#mask_between-321"><span class="linenos">321</span></a><span class="sd">    -------</span>
</span><span id="mask_between-322"><a href="#mask_between-322"><span class="linenos">322</span></a><span class="sd">    numpy.ndarray[bool]</span>
</span><span id="mask_between-323"><a href="#mask_between-323"><span class="linenos">323</span></a><span class="sd">        Boolean mask that is True between the locations.</span>
</span><span id="mask_between-324"><a href="#mask_between-324"><span class="linenos">324</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="mask_between-325"><a href="#mask_between-325"><span class="linenos">325</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
</span><span id="mask_between-326"><a href="#mask_between-326"><span class="linenos">326</span></a>    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
</span><span id="mask_between-327"><a href="#mask_between-327"><span class="linenos">327</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="mask_between-328"><a href="#mask_between-328"><span class="linenos">328</span></a>
</span><span id="mask_between-329"><a href="#mask_between-329"><span class="linenos">329</span></a>    <span class="k">return</span> <span class="n">mask</span>
</span></pre></div>


            <div class="docstring"><p>Mask out everything except the parts between the given timestamps</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (numpy.ndarray[Any, dtype[float]]):
Time series to be masked.</li>
<li><strong>locations</strong> (numpy.ndarray[Any, dtype[float]]):
Pairs of points in the time series. Everything but the space between points is masked.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray[bool]</strong>: Boolean mask that is True between the locations.</li>
</ul>
</div>


                </section>
                <section id="mark_gaps">
                            <input id="mark_gaps-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">mark_gaps</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">min_gap</span><span class="o">=</span><span class="mf">1.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mark_gaps-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mark_gaps"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mark_gaps-332"><a href="#mark_gaps-332"><span class="linenos">332</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="mark_gaps-333"><a href="#mark_gaps-333"><span class="linenos">333</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mark_gaps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">min_gap</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
</span><span id="mark_gaps-334"><a href="#mark_gaps-334"><span class="linenos">334</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark gaps in a time series.</span>
</span><span id="mark_gaps-335"><a href="#mark_gaps-335"><span class="linenos">335</span></a>
</span><span id="mark_gaps-336"><a href="#mark_gaps-336"><span class="linenos">336</span></a><span class="sd">    Parameters</span>
</span><span id="mark_gaps-337"><a href="#mark_gaps-337"><span class="linenos">337</span></a><span class="sd">    ----------</span>
</span><span id="mark_gaps-338"><a href="#mark_gaps-338"><span class="linenos">338</span></a><span class="sd">    x: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="mark_gaps-339"><a href="#mark_gaps-339"><span class="linenos">339</span></a><span class="sd">        Time series with gaps.</span>
</span><span id="mark_gaps-340"><a href="#mark_gaps-340"><span class="linenos">340</span></a><span class="sd">    min_gap: float, optional</span>
</span><span id="mark_gaps-341"><a href="#mark_gaps-341"><span class="linenos">341</span></a><span class="sd">        Minimum width for a gap (in time units).</span>
</span><span id="mark_gaps-342"><a href="#mark_gaps-342"><span class="linenos">342</span></a>
</span><span id="mark_gaps-343"><a href="#mark_gaps-343"><span class="linenos">343</span></a><span class="sd">    Returns</span>
</span><span id="mark_gaps-344"><a href="#mark_gaps-344"><span class="linenos">344</span></a><span class="sd">    -------</span>
</span><span id="mark_gaps-345"><a href="#mark_gaps-345"><span class="linenos">345</span></a><span class="sd">    gaps: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="mark_gaps-346"><a href="#mark_gaps-346"><span class="linenos">346</span></a><span class="sd">        Gap timestamps in pairs.</span>
</span><span id="mark_gaps-347"><a href="#mark_gaps-347"><span class="linenos">347</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="mark_gaps-348"><a href="#mark_gaps-348"><span class="linenos">348</span></a>    <span class="c1"># mark the gaps</span>
</span><span id="mark_gaps-349"><a href="#mark_gaps-349"><span class="linenos">349</span></a>    <span class="n">t_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="mark_gaps-350"><a href="#mark_gaps-350"><span class="linenos">350</span></a>    <span class="n">t_diff</span> <span class="o">=</span> <span class="n">t_sorted</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">t_sorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># np.diff(a)</span>
</span><span id="mark_gaps-351"><a href="#mark_gaps-351"><span class="linenos">351</span></a>    <span class="n">gaps</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_diff</span> <span class="o">&gt;</span> <span class="n">min_gap</span><span class="p">)</span>
</span><span id="mark_gaps-352"><a href="#mark_gaps-352"><span class="linenos">352</span></a>
</span><span id="mark_gaps-353"><a href="#mark_gaps-353"><span class="linenos">353</span></a>    <span class="c1"># get the timestamps</span>
</span><span id="mark_gaps-354"><a href="#mark_gaps-354"><span class="linenos">354</span></a>    <span class="n">t_left</span> <span class="o">=</span> <span class="n">t_sorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">gaps</span><span class="p">]</span>
</span><span id="mark_gaps-355"><a href="#mark_gaps-355"><span class="linenos">355</span></a>    <span class="n">t_right</span> <span class="o">=</span> <span class="n">t_sorted</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">gaps</span><span class="p">]</span>
</span><span id="mark_gaps-356"><a href="#mark_gaps-356"><span class="linenos">356</span></a>    <span class="n">gaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">t_left</span><span class="p">,</span> <span class="n">t_right</span><span class="p">))</span>
</span><span id="mark_gaps-357"><a href="#mark_gaps-357"><span class="linenos">357</span></a>
</span><span id="mark_gaps-358"><a href="#mark_gaps-358"><span class="linenos">358</span></a>    <span class="k">return</span> <span class="n">gaps</span>
</span></pre></div>


            <div class="docstring"><p>Mark gaps in a time series.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (numpy.ndarray[Any, dtype[float]]):
Time series with gaps.</li>
<li><strong>min_gap</strong> (float, optional):
Minimum width for a gap (in time units).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gaps</strong> (numpy.ndarray[Any, dtype[float]]):
Gap timestamps in pairs.</li>
</ul>
</div>


                </section>
                <section id="n_parameters">
                            <input id="n_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">n_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n_chunks</span>, </span><span class="param"><span class="n">n_sinusoids</span>, </span><span class="param"><span class="n">n_harmonics</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="n_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#n_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="n_parameters-361"><a href="#n_parameters-361"><span class="linenos">361</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="n_parameters-362"><a href="#n_parameters-362"><span class="linenos">362</span></a><span class="k">def</span><span class="w"> </span><span class="nf">n_parameters</span><span class="p">(</span><span class="n">n_chunks</span><span class="p">,</span> <span class="n">n_sinusoids</span><span class="p">,</span> <span class="n">n_harmonics</span><span class="p">):</span>
</span><span id="n_parameters-363"><a href="#n_parameters-363"><span class="linenos">363</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the number of parameters of the model.&quot;&quot;&quot;</span>
</span><span id="n_parameters-364"><a href="#n_parameters-364"><span class="linenos">364</span></a>    <span class="c1"># equation for number of parameters</span>
</span><span id="n_parameters-365"><a href="#n_parameters-365"><span class="linenos">365</span></a>    <span class="n">n_param</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_chunks</span>  <span class="c1"># time chunk each with constant and slope</span>
</span><span id="n_parameters-366"><a href="#n_parameters-366"><span class="linenos">366</span></a>    <span class="n">n_param</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_harmonics</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># one period if harmonics present</span>
</span><span id="n_parameters-367"><a href="#n_parameters-367"><span class="linenos">367</span></a>    <span class="n">n_param</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_harmonics</span>  <span class="c1"># harmonics (sinusoids with constrained frequency)</span>
</span><span id="n_parameters-368"><a href="#n_parameters-368"><span class="linenos">368</span></a>    <span class="n">n_param</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_sinusoids</span> <span class="o">-</span> <span class="n">n_harmonics</span><span class="p">)</span>  <span class="c1"># sinusoids with free frequency</span>
</span><span id="n_parameters-369"><a href="#n_parameters-369"><span class="linenos">369</span></a>
</span><span id="n_parameters-370"><a href="#n_parameters-370"><span class="linenos">370</span></a>    <span class="k">return</span> <span class="n">n_param</span>
</span></pre></div>


            <div class="docstring"><p>Return the number of parameters of the model.</p>
</div>


                </section>
                <section id="correct_for_crowdsap">
                            <input id="correct_for_crowdsap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">correct_for_crowdsap</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">flux</span>, </span><span class="param"><span class="n">crowdsap</span>, </span><span class="param"><span class="n">i_chunks</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="correct_for_crowdsap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#correct_for_crowdsap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="correct_for_crowdsap-373"><a href="#correct_for_crowdsap-373"><span class="linenos">373</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="correct_for_crowdsap-374"><a href="#correct_for_crowdsap-374"><span class="linenos">374</span></a><span class="k">def</span><span class="w"> </span><span class="nf">correct_for_crowdsap</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">crowdsap</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="correct_for_crowdsap-375"><a href="#correct_for_crowdsap-375"><span class="linenos">375</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Correct the flux for flux contribution of a third source</span>
</span><span id="correct_for_crowdsap-376"><a href="#correct_for_crowdsap-376"><span class="linenos">376</span></a><span class="sd">    </span>
</span><span id="correct_for_crowdsap-377"><a href="#correct_for_crowdsap-377"><span class="linenos">377</span></a><span class="sd">    Parameters</span>
</span><span id="correct_for_crowdsap-378"><a href="#correct_for_crowdsap-378"><span class="linenos">378</span></a><span class="sd">    ----------</span>
</span><span id="correct_for_crowdsap-379"><a href="#correct_for_crowdsap-379"><span class="linenos">379</span></a><span class="sd">    flux: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="correct_for_crowdsap-380"><a href="#correct_for_crowdsap-380"><span class="linenos">380</span></a><span class="sd">        Measurement values of the time series</span>
</span><span id="correct_for_crowdsap-381"><a href="#correct_for_crowdsap-381"><span class="linenos">381</span></a><span class="sd">    crowdsap: list[float], numpy.ndarray[Any, dtype[float]]</span>
</span><span id="correct_for_crowdsap-382"><a href="#correct_for_crowdsap-382"><span class="linenos">382</span></a><span class="sd">        Light contamination parameter (1-third_light) listed per sector</span>
</span><span id="correct_for_crowdsap-383"><a href="#correct_for_crowdsap-383"><span class="linenos">383</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="correct_for_crowdsap-384"><a href="#correct_for_crowdsap-384"><span class="linenos">384</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="correct_for_crowdsap-385"><a href="#correct_for_crowdsap-385"><span class="linenos">385</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="correct_for_crowdsap-386"><a href="#correct_for_crowdsap-386"><span class="linenos">386</span></a><span class="sd">    </span>
</span><span id="correct_for_crowdsap-387"><a href="#correct_for_crowdsap-387"><span class="linenos">387</span></a><span class="sd">    Returns</span>
</span><span id="correct_for_crowdsap-388"><a href="#correct_for_crowdsap-388"><span class="linenos">388</span></a><span class="sd">    -------</span>
</span><span id="correct_for_crowdsap-389"><a href="#correct_for_crowdsap-389"><span class="linenos">389</span></a><span class="sd">    numpy.ndarray[Any, dtype[float]]</span>
</span><span id="correct_for_crowdsap-390"><a href="#correct_for_crowdsap-390"><span class="linenos">390</span></a><span class="sd">        Measurement values of the time series corrected for</span>
</span><span id="correct_for_crowdsap-391"><a href="#correct_for_crowdsap-391"><span class="linenos">391</span></a><span class="sd">        contaminating light</span>
</span><span id="correct_for_crowdsap-392"><a href="#correct_for_crowdsap-392"><span class="linenos">392</span></a><span class="sd">    </span>
</span><span id="correct_for_crowdsap-393"><a href="#correct_for_crowdsap-393"><span class="linenos">393</span></a><span class="sd">    Notes</span>
</span><span id="correct_for_crowdsap-394"><a href="#correct_for_crowdsap-394"><span class="linenos">394</span></a><span class="sd">    -----</span>
</span><span id="correct_for_crowdsap-395"><a href="#correct_for_crowdsap-395"><span class="linenos">395</span></a><span class="sd">    Uses the parameter CROWDSAP included with some TESS data.</span>
</span><span id="correct_for_crowdsap-396"><a href="#correct_for_crowdsap-396"><span class="linenos">396</span></a><span class="sd">    flux_corrected = (flux - (1 - crowdsap)) / crowdsap</span>
</span><span id="correct_for_crowdsap-397"><a href="#correct_for_crowdsap-397"><span class="linenos">397</span></a><span class="sd">    where all quantities are median-normalised, including the result.</span>
</span><span id="correct_for_crowdsap-398"><a href="#correct_for_crowdsap-398"><span class="linenos">398</span></a><span class="sd">    This corresponds to subtracting a fraction of (1 - crowdsap) of third light</span>
</span><span id="correct_for_crowdsap-399"><a href="#correct_for_crowdsap-399"><span class="linenos">399</span></a><span class="sd">    from the (non-median-normalised) flux measurements.</span>
</span><span id="correct_for_crowdsap-400"><a href="#correct_for_crowdsap-400"><span class="linenos">400</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="correct_for_crowdsap-401"><a href="#correct_for_crowdsap-401"><span class="linenos">401</span></a>    <span class="n">cor_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span>
</span><span id="correct_for_crowdsap-402"><a href="#correct_for_crowdsap-402"><span class="linenos">402</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">):</span>
</span><span id="correct_for_crowdsap-403"><a href="#correct_for_crowdsap-403"><span class="linenos">403</span></a>        <span class="n">crowd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">crowdsap</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">1.</span><span class="p">)</span>  <span class="c1"># clip to avoid unphysical output</span>
</span><span id="correct_for_crowdsap-404"><a href="#correct_for_crowdsap-404"><span class="linenos">404</span></a>        <span class="n">cor_flux</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">crowd</span><span class="p">)</span> <span class="o">/</span> <span class="n">crowd</span>
</span><span id="correct_for_crowdsap-405"><a href="#correct_for_crowdsap-405"><span class="linenos">405</span></a>
</span><span id="correct_for_crowdsap-406"><a href="#correct_for_crowdsap-406"><span class="linenos">406</span></a>    <span class="k">return</span> <span class="n">cor_flux</span>
</span></pre></div>


            <div class="docstring"><p>Correct the flux for flux contribution of a third source</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>flux</strong> (numpy.ndarray[Any, dtype[float]]):
Measurement values of the time series</li>
<li><strong>crowdsap</strong> (list[float], numpy.ndarray[Any, dtype[float]]):
Light contamination parameter (1-third_light) listed per sector</li>
<li><strong>i_chunks</strong> (numpy.ndarray[Any, dtype[int]]):
Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like
the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray[Any, dtype[float]]</strong>: Measurement values of the time series corrected for
contaminating light</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Uses the parameter CROWDSAP included with some TESS data.
flux_corrected = (flux - (1 - crowdsap)) / crowdsap
where all quantities are median-normalised, including the result.
This corresponds to subtracting a fraction of (1 - crowdsap) of third light
from the (non-median-normalised) flux measurements.</p>
</div>


                </section>
                <section id="model_crowdsap">
                            <input id="model_crowdsap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">model_crowdsap</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">flux</span>, </span><span class="param"><span class="n">crowdsap</span>, </span><span class="param"><span class="n">i_chunks</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="model_crowdsap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#model_crowdsap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="model_crowdsap-409"><a href="#model_crowdsap-409"><span class="linenos">409</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="model_crowdsap-410"><a href="#model_crowdsap-410"><span class="linenos">410</span></a><span class="k">def</span><span class="w"> </span><span class="nf">model_crowdsap</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">crowdsap</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="model_crowdsap-411"><a href="#model_crowdsap-411"><span class="linenos">411</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Incorporate flux contribution of a third source into the flux</span>
</span><span id="model_crowdsap-412"><a href="#model_crowdsap-412"><span class="linenos">412</span></a>
</span><span id="model_crowdsap-413"><a href="#model_crowdsap-413"><span class="linenos">413</span></a><span class="sd">    Parameters</span>
</span><span id="model_crowdsap-414"><a href="#model_crowdsap-414"><span class="linenos">414</span></a><span class="sd">    ----------</span>
</span><span id="model_crowdsap-415"><a href="#model_crowdsap-415"><span class="linenos">415</span></a><span class="sd">    flux: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="model_crowdsap-416"><a href="#model_crowdsap-416"><span class="linenos">416</span></a><span class="sd">        Measurement values of the time series</span>
</span><span id="model_crowdsap-417"><a href="#model_crowdsap-417"><span class="linenos">417</span></a><span class="sd">    crowdsap: list[float], numpy.ndarray[Any, dtype[float]]</span>
</span><span id="model_crowdsap-418"><a href="#model_crowdsap-418"><span class="linenos">418</span></a><span class="sd">        Light contamination parameter (1-third_light) listed per sector</span>
</span><span id="model_crowdsap-419"><a href="#model_crowdsap-419"><span class="linenos">419</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="model_crowdsap-420"><a href="#model_crowdsap-420"><span class="linenos">420</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="model_crowdsap-421"><a href="#model_crowdsap-421"><span class="linenos">421</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="model_crowdsap-422"><a href="#model_crowdsap-422"><span class="linenos">422</span></a>
</span><span id="model_crowdsap-423"><a href="#model_crowdsap-423"><span class="linenos">423</span></a><span class="sd">    Returns</span>
</span><span id="model_crowdsap-424"><a href="#model_crowdsap-424"><span class="linenos">424</span></a><span class="sd">    -------</span>
</span><span id="model_crowdsap-425"><a href="#model_crowdsap-425"><span class="linenos">425</span></a><span class="sd">    numpy.ndarray[Any, dtype[float]]</span>
</span><span id="model_crowdsap-426"><a href="#model_crowdsap-426"><span class="linenos">426</span></a><span class="sd">        Model of the flux incorporating light contamination</span>
</span><span id="model_crowdsap-427"><a href="#model_crowdsap-427"><span class="linenos">427</span></a>
</span><span id="model_crowdsap-428"><a href="#model_crowdsap-428"><span class="linenos">428</span></a><span class="sd">    Notes</span>
</span><span id="model_crowdsap-429"><a href="#model_crowdsap-429"><span class="linenos">429</span></a><span class="sd">    -----</span>
</span><span id="model_crowdsap-430"><a href="#model_crowdsap-430"><span class="linenos">430</span></a><span class="sd">    Does the opposite as correct_for_crowdsap, to be able to model the effect of</span>
</span><span id="model_crowdsap-431"><a href="#model_crowdsap-431"><span class="linenos">431</span></a><span class="sd">    third light to some degree (can only achieve an upper bound on CROWDSAP).</span>
</span><span id="model_crowdsap-432"><a href="#model_crowdsap-432"><span class="linenos">432</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="model_crowdsap-433"><a href="#model_crowdsap-433"><span class="linenos">433</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span>
</span><span id="model_crowdsap-434"><a href="#model_crowdsap-434"><span class="linenos">434</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">):</span>
</span><span id="model_crowdsap-435"><a href="#model_crowdsap-435"><span class="linenos">435</span></a>        <span class="n">crowd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">crowdsap</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">1.</span><span class="p">)</span>  <span class="c1"># clip to avoid unphysical output</span>
</span><span id="model_crowdsap-436"><a href="#model_crowdsap-436"><span class="linenos">436</span></a>        <span class="n">model</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">crowd</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">crowd</span>
</span><span id="model_crowdsap-437"><a href="#model_crowdsap-437"><span class="linenos">437</span></a>
</span><span id="model_crowdsap-438"><a href="#model_crowdsap-438"><span class="linenos">438</span></a>    <span class="k">return</span> <span class="n">model</span>
</span></pre></div>


            <div class="docstring"><p>Incorporate flux contribution of a third source into the flux</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>flux</strong> (numpy.ndarray[Any, dtype[float]]):
Measurement values of the time series</li>
<li><strong>crowdsap</strong> (list[float], numpy.ndarray[Any, dtype[float]]):
Light contamination parameter (1-third_light) listed per sector</li>
<li><strong>i_chunks</strong> (numpy.ndarray[Any, dtype[int]]):
Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like
the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray[Any, dtype[float]]</strong>: Model of the flux incorporating light contamination</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Does the opposite as correct_for_crowdsap, to be able to model the effect of
third light to some degree (can only achieve an upper bound on CROWDSAP).</p>
</div>


                </section>
                <section id="formal_uncertainties_linear">
                            <input id="formal_uncertainties_linear-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">formal_uncertainties_linear</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">time</span>, </span><span class="param"><span class="n">residuals</span>, </span><span class="param"><span class="n">i_chunks</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="formal_uncertainties_linear-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#formal_uncertainties_linear"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="formal_uncertainties_linear-441"><a href="#formal_uncertainties_linear-441"><span class="linenos">441</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="formal_uncertainties_linear-442"><a href="#formal_uncertainties_linear-442"><span class="linenos">442</span></a><span class="k">def</span><span class="w"> </span><span class="nf">formal_uncertainties_linear</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="formal_uncertainties_linear-443"><a href="#formal_uncertainties_linear-443"><span class="linenos">443</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the corrected uncorrelated (formal) uncertainties for the</span>
</span><span id="formal_uncertainties_linear-444"><a href="#formal_uncertainties_linear-444"><span class="linenos">444</span></a><span class="sd">    parameters constant and slope.</span>
</span><span id="formal_uncertainties_linear-445"><a href="#formal_uncertainties_linear-445"><span class="linenos">445</span></a>
</span><span id="formal_uncertainties_linear-446"><a href="#formal_uncertainties_linear-446"><span class="linenos">446</span></a><span class="sd">    Parameters</span>
</span><span id="formal_uncertainties_linear-447"><a href="#formal_uncertainties_linear-447"><span class="linenos">447</span></a><span class="sd">    ----------</span>
</span><span id="formal_uncertainties_linear-448"><a href="#formal_uncertainties_linear-448"><span class="linenos">448</span></a><span class="sd">    time: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_linear-449"><a href="#formal_uncertainties_linear-449"><span class="linenos">449</span></a><span class="sd">        Timestamps of the time series</span>
</span><span id="formal_uncertainties_linear-450"><a href="#formal_uncertainties_linear-450"><span class="linenos">450</span></a><span class="sd">    residuals: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_linear-451"><a href="#formal_uncertainties_linear-451"><span class="linenos">451</span></a><span class="sd">        Residual is flux - model</span>
</span><span id="formal_uncertainties_linear-452"><a href="#formal_uncertainties_linear-452"><span class="linenos">452</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="formal_uncertainties_linear-453"><a href="#formal_uncertainties_linear-453"><span class="linenos">453</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="formal_uncertainties_linear-454"><a href="#formal_uncertainties_linear-454"><span class="linenos">454</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="formal_uncertainties_linear-455"><a href="#formal_uncertainties_linear-455"><span class="linenos">455</span></a>
</span><span id="formal_uncertainties_linear-456"><a href="#formal_uncertainties_linear-456"><span class="linenos">456</span></a><span class="sd">    Returns</span>
</span><span id="formal_uncertainties_linear-457"><a href="#formal_uncertainties_linear-457"><span class="linenos">457</span></a><span class="sd">    -------</span>
</span><span id="formal_uncertainties_linear-458"><a href="#formal_uncertainties_linear-458"><span class="linenos">458</span></a><span class="sd">    tuple</span>
</span><span id="formal_uncertainties_linear-459"><a href="#formal_uncertainties_linear-459"><span class="linenos">459</span></a><span class="sd">        A tuple containing the following elements:</span>
</span><span id="formal_uncertainties_linear-460"><a href="#formal_uncertainties_linear-460"><span class="linenos">460</span></a><span class="sd">        sigma_const: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_linear-461"><a href="#formal_uncertainties_linear-461"><span class="linenos">461</span></a><span class="sd">            Uncertainty in the constant for each sector</span>
</span><span id="formal_uncertainties_linear-462"><a href="#formal_uncertainties_linear-462"><span class="linenos">462</span></a><span class="sd">        sigma_slope: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_linear-463"><a href="#formal_uncertainties_linear-463"><span class="linenos">463</span></a><span class="sd">            Uncertainty in the slope for each sector</span>
</span><span id="formal_uncertainties_linear-464"><a href="#formal_uncertainties_linear-464"><span class="linenos">464</span></a>
</span><span id="formal_uncertainties_linear-465"><a href="#formal_uncertainties_linear-465"><span class="linenos">465</span></a><span class="sd">    Notes</span>
</span><span id="formal_uncertainties_linear-466"><a href="#formal_uncertainties_linear-466"><span class="linenos">466</span></a><span class="sd">    -----</span>
</span><span id="formal_uncertainties_linear-467"><a href="#formal_uncertainties_linear-467"><span class="linenos">467</span></a><span class="sd">    Errors in const and slope:</span>
</span><span id="formal_uncertainties_linear-468"><a href="#formal_uncertainties_linear-468"><span class="linenos">468</span></a><span class="sd">    https://pages.mtu.edu/~fmorriso/cm3215/UncertaintySlopeInterceptOfLeastSquaresFit.pdf</span>
</span><span id="formal_uncertainties_linear-469"><a href="#formal_uncertainties_linear-469"><span class="linenos">469</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="formal_uncertainties_linear-470"><a href="#formal_uncertainties_linear-470"><span class="linenos">470</span></a>    <span class="n">n_param</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="formal_uncertainties_linear-471"><a href="#formal_uncertainties_linear-471"><span class="linenos">471</span></a>
</span><span id="formal_uncertainties_linear-472"><a href="#formal_uncertainties_linear-472"><span class="linenos">472</span></a>    <span class="c1"># linear regression uncertainties</span>
</span><span id="formal_uncertainties_linear-473"><a href="#formal_uncertainties_linear-473"><span class="linenos">473</span></a>    <span class="n">sigma_const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">))</span>
</span><span id="formal_uncertainties_linear-474"><a href="#formal_uncertainties_linear-474"><span class="linenos">474</span></a>    <span class="n">sigma_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">))</span>
</span><span id="formal_uncertainties_linear-475"><a href="#formal_uncertainties_linear-475"><span class="linenos">475</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">):</span>
</span><span id="formal_uncertainties_linear-476"><a href="#formal_uncertainties_linear-476"><span class="linenos">476</span></a>        <span class="n">len_t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="formal_uncertainties_linear-477"><a href="#formal_uncertainties_linear-477"><span class="linenos">477</span></a>        <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># same as len_t, but just for the sake of clarity</span>
</span><span id="formal_uncertainties_linear-478"><a href="#formal_uncertainties_linear-478"><span class="linenos">478</span></a>        <span class="n">n_dof</span> <span class="o">=</span> <span class="n">n_data</span> <span class="o">-</span> <span class="n">n_param</span>  <span class="c1"># degrees of freedom</span>
</span><span id="formal_uncertainties_linear-479"><a href="#formal_uncertainties_linear-479"><span class="linenos">479</span></a>
</span><span id="formal_uncertainties_linear-480"><a href="#formal_uncertainties_linear-480"><span class="linenos">480</span></a>        <span class="c1"># standard deviation of the residuals but per sector</span>
</span><span id="formal_uncertainties_linear-481"><a href="#formal_uncertainties_linear-481"><span class="linenos">481</span></a>        <span class="n">std</span> <span class="o">=</span> <span class="n">std_unb</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">n_dof</span><span class="p">)</span>
</span><span id="formal_uncertainties_linear-482"><a href="#formal_uncertainties_linear-482"><span class="linenos">482</span></a>
</span><span id="formal_uncertainties_linear-483"><a href="#formal_uncertainties_linear-483"><span class="linenos">483</span></a>        <span class="c1"># some sums for the uncertainty formulae</span>
</span><span id="formal_uncertainties_linear-484"><a href="#formal_uncertainties_linear-484"><span class="linenos">484</span></a>        <span class="n">sum_t</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="formal_uncertainties_linear-485"><a href="#formal_uncertainties_linear-485"><span class="linenos">485</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
</span><span id="formal_uncertainties_linear-486"><a href="#formal_uncertainties_linear-486"><span class="linenos">486</span></a>            <span class="n">sum_t</span> <span class="o">+=</span> <span class="n">t</span>
</span><span id="formal_uncertainties_linear-487"><a href="#formal_uncertainties_linear-487"><span class="linenos">487</span></a>        <span class="n">ss_xx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="formal_uncertainties_linear-488"><a href="#formal_uncertainties_linear-488"><span class="linenos">488</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
</span><span id="formal_uncertainties_linear-489"><a href="#formal_uncertainties_linear-489"><span class="linenos">489</span></a>            <span class="n">ss_xx</span> <span class="o">+=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">sum_t</span> <span class="o">/</span> <span class="n">len_t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</span><span id="formal_uncertainties_linear-490"><a href="#formal_uncertainties_linear-490"><span class="linenos">490</span></a>        <span class="n">sigma_const</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_data</span> <span class="o">+</span> <span class="p">(</span><span class="n">sum_t</span> <span class="o">/</span> <span class="n">len_t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">ss_xx</span><span class="p">)</span>
</span><span id="formal_uncertainties_linear-491"><a href="#formal_uncertainties_linear-491"><span class="linenos">491</span></a>        <span class="n">sigma_slope</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ss_xx</span><span class="p">)</span>
</span><span id="formal_uncertainties_linear-492"><a href="#formal_uncertainties_linear-492"><span class="linenos">492</span></a>
</span><span id="formal_uncertainties_linear-493"><a href="#formal_uncertainties_linear-493"><span class="linenos">493</span></a>    <span class="k">return</span> <span class="n">sigma_const</span><span class="p">,</span> <span class="n">sigma_slope</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the corrected uncorrelated (formal) uncertainties for the
parameters constant and slope.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>time</strong> (numpy.ndarray[Any, dtype[float]]):
Timestamps of the time series</li>
<li><strong>residuals</strong> (numpy.ndarray[Any, dtype[float]]):
Residual is flux - model</li>
<li><strong>i_chunks</strong> (numpy.ndarray[Any, dtype[int]]):
Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like
the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple containing the following elements:
sigma_const: numpy.ndarray[Any, dtype[float]]
Uncertainty in the constant for each sector
sigma_slope: numpy.ndarray[Any, dtype[float]]
Uncertainty in the slope for each sector</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Errors in const and slope:
<a href="https://pages.mtu.edu/~fmorriso/cm3215/UncertaintySlopeInterceptOfLeastSquaresFit.pdf">https://pages.mtu.edu/~fmorriso/cm3215/UncertaintySlopeInterceptOfLeastSquaresFit.pdf</a></p>
</div>


                </section>
                <section id="formal_uncertainties_sinusoid">
                            <input id="formal_uncertainties_sinusoid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">formal_uncertainties_sinusoid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">time</span>, </span><span class="param"><span class="n">residuals</span>, </span><span class="param"><span class="n">flux_err</span>, </span><span class="param"><span class="n">a_n</span>, </span><span class="param"><span class="n">i_chunks</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="formal_uncertainties_sinusoid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#formal_uncertainties_sinusoid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="formal_uncertainties_sinusoid-496"><a href="#formal_uncertainties_sinusoid-496"><span class="linenos">496</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-497"><a href="#formal_uncertainties_sinusoid-497"><span class="linenos">497</span></a><span class="k">def</span><span class="w"> </span><span class="nf">formal_uncertainties_sinusoid</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">flux_err</span><span class="p">,</span> <span class="n">a_n</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="formal_uncertainties_sinusoid-498"><a href="#formal_uncertainties_sinusoid-498"><span class="linenos">498</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the corrected uncorrelated (formal) uncertainties for the frequencies, amplitudes, and phases.</span>
</span><span id="formal_uncertainties_sinusoid-499"><a href="#formal_uncertainties_sinusoid-499"><span class="linenos">499</span></a>
</span><span id="formal_uncertainties_sinusoid-500"><a href="#formal_uncertainties_sinusoid-500"><span class="linenos">500</span></a><span class="sd">    Harmonics are not taken into account.</span>
</span><span id="formal_uncertainties_sinusoid-501"><a href="#formal_uncertainties_sinusoid-501"><span class="linenos">501</span></a>
</span><span id="formal_uncertainties_sinusoid-502"><a href="#formal_uncertainties_sinusoid-502"><span class="linenos">502</span></a><span class="sd">    Parameters</span>
</span><span id="formal_uncertainties_sinusoid-503"><a href="#formal_uncertainties_sinusoid-503"><span class="linenos">503</span></a><span class="sd">    ----------</span>
</span><span id="formal_uncertainties_sinusoid-504"><a href="#formal_uncertainties_sinusoid-504"><span class="linenos">504</span></a><span class="sd">    time: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_sinusoid-505"><a href="#formal_uncertainties_sinusoid-505"><span class="linenos">505</span></a><span class="sd">        Timestamps of the time series</span>
</span><span id="formal_uncertainties_sinusoid-506"><a href="#formal_uncertainties_sinusoid-506"><span class="linenos">506</span></a><span class="sd">    residuals: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_sinusoid-507"><a href="#formal_uncertainties_sinusoid-507"><span class="linenos">507</span></a><span class="sd">        Residual is flux - model</span>
</span><span id="formal_uncertainties_sinusoid-508"><a href="#formal_uncertainties_sinusoid-508"><span class="linenos">508</span></a><span class="sd">    flux_err: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_sinusoid-509"><a href="#formal_uncertainties_sinusoid-509"><span class="linenos">509</span></a><span class="sd">        Errors in the measurement values</span>
</span><span id="formal_uncertainties_sinusoid-510"><a href="#formal_uncertainties_sinusoid-510"><span class="linenos">510</span></a><span class="sd">    a_n: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_sinusoid-511"><a href="#formal_uncertainties_sinusoid-511"><span class="linenos">511</span></a><span class="sd">        The amplitudes of a number of sinusoids</span>
</span><span id="formal_uncertainties_sinusoid-512"><a href="#formal_uncertainties_sinusoid-512"><span class="linenos">512</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="formal_uncertainties_sinusoid-513"><a href="#formal_uncertainties_sinusoid-513"><span class="linenos">513</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="formal_uncertainties_sinusoid-514"><a href="#formal_uncertainties_sinusoid-514"><span class="linenos">514</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="formal_uncertainties_sinusoid-515"><a href="#formal_uncertainties_sinusoid-515"><span class="linenos">515</span></a>
</span><span id="formal_uncertainties_sinusoid-516"><a href="#formal_uncertainties_sinusoid-516"><span class="linenos">516</span></a><span class="sd">    Returns</span>
</span><span id="formal_uncertainties_sinusoid-517"><a href="#formal_uncertainties_sinusoid-517"><span class="linenos">517</span></a><span class="sd">    -------</span>
</span><span id="formal_uncertainties_sinusoid-518"><a href="#formal_uncertainties_sinusoid-518"><span class="linenos">518</span></a><span class="sd">    tuple</span>
</span><span id="formal_uncertainties_sinusoid-519"><a href="#formal_uncertainties_sinusoid-519"><span class="linenos">519</span></a><span class="sd">        A tuple containing the following elements:</span>
</span><span id="formal_uncertainties_sinusoid-520"><a href="#formal_uncertainties_sinusoid-520"><span class="linenos">520</span></a><span class="sd">        sigma_f: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_sinusoid-521"><a href="#formal_uncertainties_sinusoid-521"><span class="linenos">521</span></a><span class="sd">            Uncertainty in the frequency for each sinusoid.</span>
</span><span id="formal_uncertainties_sinusoid-522"><a href="#formal_uncertainties_sinusoid-522"><span class="linenos">522</span></a><span class="sd">        sigma_a: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_sinusoid-523"><a href="#formal_uncertainties_sinusoid-523"><span class="linenos">523</span></a><span class="sd">            Uncertainty in the amplitude for each sinusoid (these are identical).</span>
</span><span id="formal_uncertainties_sinusoid-524"><a href="#formal_uncertainties_sinusoid-524"><span class="linenos">524</span></a><span class="sd">        sigma_ph: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_sinusoid-525"><a href="#formal_uncertainties_sinusoid-525"><span class="linenos">525</span></a><span class="sd">            Uncertainty in the phase for each sinusoid.</span>
</span><span id="formal_uncertainties_sinusoid-526"><a href="#formal_uncertainties_sinusoid-526"><span class="linenos">526</span></a>
</span><span id="formal_uncertainties_sinusoid-527"><a href="#formal_uncertainties_sinusoid-527"><span class="linenos">527</span></a><span class="sd">    Notes</span>
</span><span id="formal_uncertainties_sinusoid-528"><a href="#formal_uncertainties_sinusoid-528"><span class="linenos">528</span></a><span class="sd">    -----</span>
</span><span id="formal_uncertainties_sinusoid-529"><a href="#formal_uncertainties_sinusoid-529"><span class="linenos">529</span></a><span class="sd">    As in Aerts 2021, https://ui.adsabs.harvard.edu/abs/2021RvMP...93a5001A/abstract</span>
</span><span id="formal_uncertainties_sinusoid-530"><a href="#formal_uncertainties_sinusoid-530"><span class="linenos">530</span></a><span class="sd">    The sigma value in the formulae is approximated by taking the maximum of the</span>
</span><span id="formal_uncertainties_sinusoid-531"><a href="#formal_uncertainties_sinusoid-531"><span class="linenos">531</span></a><span class="sd">    standard deviation of the residuals and the standard error of the minimum data error.</span>
</span><span id="formal_uncertainties_sinusoid-532"><a href="#formal_uncertainties_sinusoid-532"><span class="linenos">532</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="formal_uncertainties_sinusoid-533"><a href="#formal_uncertainties_sinusoid-533"><span class="linenos">533</span></a>    <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-534"><a href="#formal_uncertainties_sinusoid-534"><span class="linenos">534</span></a>    <span class="n">n_param</span> <span class="o">=</span> <span class="n">n_parameters</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_n</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># number of parameters in the model</span>
</span><span id="formal_uncertainties_sinusoid-535"><a href="#formal_uncertainties_sinusoid-535"><span class="linenos">535</span></a>    <span class="n">n_dof</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_data</span> <span class="o">-</span> <span class="n">n_param</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># degrees of freedom</span>
</span><span id="formal_uncertainties_sinusoid-536"><a href="#formal_uncertainties_sinusoid-536"><span class="linenos">536</span></a>
</span><span id="formal_uncertainties_sinusoid-537"><a href="#formal_uncertainties_sinusoid-537"><span class="linenos">537</span></a>    <span class="c1"># calculate the standard deviation of the residuals</span>
</span><span id="formal_uncertainties_sinusoid-538"><a href="#formal_uncertainties_sinusoid-538"><span class="linenos">538</span></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">std_unb</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">n_dof</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-539"><a href="#formal_uncertainties_sinusoid-539"><span class="linenos">539</span></a>
</span><span id="formal_uncertainties_sinusoid-540"><a href="#formal_uncertainties_sinusoid-540"><span class="linenos">540</span></a>    <span class="c1"># calculate the standard error based on the smallest data error</span>
</span><span id="formal_uncertainties_sinusoid-541"><a href="#formal_uncertainties_sinusoid-541"><span class="linenos">541</span></a>    <span class="n">ste</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flux_err</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-542"><a href="#formal_uncertainties_sinusoid-542"><span class="linenos">542</span></a>
</span><span id="formal_uncertainties_sinusoid-543"><a href="#formal_uncertainties_sinusoid-543"><span class="linenos">543</span></a>    <span class="c1"># take the maximum of the standard deviation and standard error as sigma N</span>
</span><span id="formal_uncertainties_sinusoid-544"><a href="#formal_uncertainties_sinusoid-544"><span class="linenos">544</span></a>    <span class="n">sigma_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">ste</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-545"><a href="#formal_uncertainties_sinusoid-545"><span class="linenos">545</span></a>
</span><span id="formal_uncertainties_sinusoid-546"><a href="#formal_uncertainties_sinusoid-546"><span class="linenos">546</span></a>    <span class="c1"># calculate the D factor (square root of the average number of consecutive data points of the same sign)</span>
</span><span id="formal_uncertainties_sinusoid-547"><a href="#formal_uncertainties_sinusoid-547"><span class="linenos">547</span></a>    <span class="n">positive</span> <span class="o">=</span> <span class="p">(</span><span class="n">residuals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-548"><a href="#formal_uncertainties_sinusoid-548"><span class="linenos">548</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-549"><a href="#formal_uncertainties_sinusoid-549"><span class="linenos">549</span></a>    <span class="n">zero_crossings</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">positive</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">positive</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)]</span>
</span><span id="formal_uncertainties_sinusoid-550"><a href="#formal_uncertainties_sinusoid-550"><span class="linenos">550</span></a>    <span class="n">sss_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">zero_crossings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_data</span><span class="p">])))</span>  <span class="c1"># same-sign sequence indices</span>
</span><span id="formal_uncertainties_sinusoid-551"><a href="#formal_uncertainties_sinusoid-551"><span class="linenos">551</span></a>    <span class="n">d_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sss_i</span><span class="p">)))</span>
</span><span id="formal_uncertainties_sinusoid-552"><a href="#formal_uncertainties_sinusoid-552"><span class="linenos">552</span></a>
</span><span id="formal_uncertainties_sinusoid-553"><a href="#formal_uncertainties_sinusoid-553"><span class="linenos">553</span></a>    <span class="c1"># uncertainty formulae for sinusoids</span>
</span><span id="formal_uncertainties_sinusoid-554"><a href="#formal_uncertainties_sinusoid-554"><span class="linenos">554</span></a>    <span class="n">sigma_f</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
</span><span id="formal_uncertainties_sinusoid-555"><a href="#formal_uncertainties_sinusoid-555"><span class="linenos">555</span></a>    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-556"><a href="#formal_uncertainties_sinusoid-556"><span class="linenos">556</span></a>    <span class="n">sigma_ph</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span> <span class="o">/</span> <span class="n">a_n</span>  <span class="c1"># times 2 pi w.r.t. the paper</span>
</span><span id="formal_uncertainties_sinusoid-557"><a href="#formal_uncertainties_sinusoid-557"><span class="linenos">557</span></a>
</span><span id="formal_uncertainties_sinusoid-558"><a href="#formal_uncertainties_sinusoid-558"><span class="linenos">558</span></a>    <span class="c1"># make an array of sigma_a (these are the same)</span>
</span><span id="formal_uncertainties_sinusoid-559"><a href="#formal_uncertainties_sinusoid-559"><span class="linenos">559</span></a>    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_n</span><span class="p">),</span> <span class="n">sigma_a</span><span class="p">)</span>
</span><span id="formal_uncertainties_sinusoid-560"><a href="#formal_uncertainties_sinusoid-560"><span class="linenos">560</span></a>
</span><span id="formal_uncertainties_sinusoid-561"><a href="#formal_uncertainties_sinusoid-561"><span class="linenos">561</span></a>    <span class="k">return</span> <span class="n">sigma_f</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_ph</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the corrected uncorrelated (formal) uncertainties for the frequencies, amplitudes, and phases.</p>

<p>Harmonics are not taken into account.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>time</strong> (numpy.ndarray[Any, dtype[float]]):
Timestamps of the time series</li>
<li><strong>residuals</strong> (numpy.ndarray[Any, dtype[float]]):
Residual is flux - model</li>
<li><strong>flux_err</strong> (numpy.ndarray[Any, dtype[float]]):
Errors in the measurement values</li>
<li><strong>a_n</strong> (numpy.ndarray[Any, dtype[float]]):
The amplitudes of a number of sinusoids</li>
<li><strong>i_chunks</strong> (numpy.ndarray[Any, dtype[int]]):
Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like
the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple containing the following elements:
sigma_f: numpy.ndarray[Any, dtype[float]]
Uncertainty in the frequency for each sinusoid.
sigma_a: numpy.ndarray[Any, dtype[float]]
Uncertainty in the amplitude for each sinusoid (these are identical).
sigma_ph: numpy.ndarray[Any, dtype[float]]
Uncertainty in the phase for each sinusoid.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>As in Aerts 2021, <a href="https://ui.adsabs.harvard.edu/abs/2021RvMP...93a5001A/abstract">https://ui.adsabs.harvard.edu/abs/2021RvMP...93a5001A/abstract</a>
The sigma value in the formulae is approximated by taking the maximum of the
standard deviation of the residuals and the standard error of the minimum data error.</p>
</div>


                </section>
                <section id="formal_uncertainties_harmonic">
                            <input id="formal_uncertainties_harmonic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">formal_uncertainties_harmonic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sigma_f</span>, </span><span class="param"><span class="n">h_base</span>, </span><span class="param"><span class="n">h_mult</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="formal_uncertainties_harmonic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#formal_uncertainties_harmonic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="formal_uncertainties_harmonic-564"><a href="#formal_uncertainties_harmonic-564"><span class="linenos">564</span></a><span class="k">def</span><span class="w"> </span><span class="nf">formal_uncertainties_harmonic</span><span class="p">(</span><span class="n">sigma_f</span><span class="p">,</span> <span class="n">h_base</span><span class="p">,</span> <span class="n">h_mult</span><span class="p">):</span>
</span><span id="formal_uncertainties_harmonic-565"><a href="#formal_uncertainties_harmonic-565"><span class="linenos">565</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the uncertainty in the harmonic frequencies based on the unconstrained frequency</span>
</span><span id="formal_uncertainties_harmonic-566"><a href="#formal_uncertainties_harmonic-566"><span class="linenos">566</span></a><span class="sd">    uncertainties using a simple weighted average.</span>
</span><span id="formal_uncertainties_harmonic-567"><a href="#formal_uncertainties_harmonic-567"><span class="linenos">567</span></a>
</span><span id="formal_uncertainties_harmonic-568"><a href="#formal_uncertainties_harmonic-568"><span class="linenos">568</span></a><span class="sd">    The base frequency&#39;s uncertainty is calculated as:</span>
</span><span id="formal_uncertainties_harmonic-569"><a href="#formal_uncertainties_harmonic-569"><span class="linenos">569</span></a><span class="sd">    σ_h1 = (∑ n^2/σ_fn^2)^(-1/2)</span>
</span><span id="formal_uncertainties_harmonic-570"><a href="#formal_uncertainties_harmonic-570"><span class="linenos">570</span></a><span class="sd">    The other uncertainties follow as:</span>
</span><span id="formal_uncertainties_harmonic-571"><a href="#formal_uncertainties_harmonic-571"><span class="linenos">571</span></a><span class="sd">    σ_hn = n * σ_h1</span>
</span><span id="formal_uncertainties_harmonic-572"><a href="#formal_uncertainties_harmonic-572"><span class="linenos">572</span></a>
</span><span id="formal_uncertainties_harmonic-573"><a href="#formal_uncertainties_harmonic-573"><span class="linenos">573</span></a><span class="sd">    Parameters</span>
</span><span id="formal_uncertainties_harmonic-574"><a href="#formal_uncertainties_harmonic-574"><span class="linenos">574</span></a><span class="sd">    ----------</span>
</span><span id="formal_uncertainties_harmonic-575"><a href="#formal_uncertainties_harmonic-575"><span class="linenos">575</span></a><span class="sd">    sigma_f: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_harmonic-576"><a href="#formal_uncertainties_harmonic-576"><span class="linenos">576</span></a><span class="sd">        Uncertainty in the frequency for each sinusoid.</span>
</span><span id="formal_uncertainties_harmonic-577"><a href="#formal_uncertainties_harmonic-577"><span class="linenos">577</span></a><span class="sd">    h_base: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="formal_uncertainties_harmonic-578"><a href="#formal_uncertainties_harmonic-578"><span class="linenos">578</span></a><span class="sd">        Indices of the base frequencies in f_n for each of f_n.</span>
</span><span id="formal_uncertainties_harmonic-579"><a href="#formal_uncertainties_harmonic-579"><span class="linenos">579</span></a><span class="sd">    h_mult: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="formal_uncertainties_harmonic-580"><a href="#formal_uncertainties_harmonic-580"><span class="linenos">580</span></a><span class="sd">        Harmonic multiplier of the base frequency for each of f_n.</span>
</span><span id="formal_uncertainties_harmonic-581"><a href="#formal_uncertainties_harmonic-581"><span class="linenos">581</span></a>
</span><span id="formal_uncertainties_harmonic-582"><a href="#formal_uncertainties_harmonic-582"><span class="linenos">582</span></a><span class="sd">    Returns</span>
</span><span id="formal_uncertainties_harmonic-583"><a href="#formal_uncertainties_harmonic-583"><span class="linenos">583</span></a><span class="sd">    -------</span>
</span><span id="formal_uncertainties_harmonic-584"><a href="#formal_uncertainties_harmonic-584"><span class="linenos">584</span></a><span class="sd">    numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties_harmonic-585"><a href="#formal_uncertainties_harmonic-585"><span class="linenos">585</span></a><span class="sd">        Uncertainty in the harmonic frequencies.</span>
</span><span id="formal_uncertainties_harmonic-586"><a href="#formal_uncertainties_harmonic-586"><span class="linenos">586</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="formal_uncertainties_harmonic-587"><a href="#formal_uncertainties_harmonic-587"><span class="linenos">587</span></a>    <span class="c1"># calculate the base frequency uncertainty</span>
</span><span id="formal_uncertainties_harmonic-588"><a href="#formal_uncertainties_harmonic-588"><span class="linenos">588</span></a>    <span class="n">sigma_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sigma_f</span><span class="p">))</span>
</span><span id="formal_uncertainties_harmonic-589"><a href="#formal_uncertainties_harmonic-589"><span class="linenos">589</span></a>    <span class="k">for</span> <span class="n">i_base</span> <span class="ow">in</span> <span class="n">h_base</span><span class="p">[</span><span class="n">h_mult</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="formal_uncertainties_harmonic-590"><a href="#formal_uncertainties_harmonic-590"><span class="linenos">590</span></a>        <span class="n">h_series</span> <span class="o">=</span> <span class="n">h_base</span> <span class="o">==</span> <span class="n">i_base</span>  <span class="c1"># select one harmonic series at a time</span>
</span><span id="formal_uncertainties_harmonic-591"><a href="#formal_uncertainties_harmonic-591"><span class="linenos">591</span></a>        <span class="n">sigma_h</span><span class="p">[</span><span class="n">h_series</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h_mult</span><span class="p">[</span><span class="n">h_series</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sigma_f</span><span class="p">[</span><span class="n">h_series</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="formal_uncertainties_harmonic-592"><a href="#formal_uncertainties_harmonic-592"><span class="linenos">592</span></a>
</span><span id="formal_uncertainties_harmonic-593"><a href="#formal_uncertainties_harmonic-593"><span class="linenos">593</span></a>    <span class="c1"># multiply by the harmonic number</span>
</span><span id="formal_uncertainties_harmonic-594"><a href="#formal_uncertainties_harmonic-594"><span class="linenos">594</span></a>    <span class="n">sigma_h</span> <span class="o">*=</span> <span class="n">h_mult</span>
</span><span id="formal_uncertainties_harmonic-595"><a href="#formal_uncertainties_harmonic-595"><span class="linenos">595</span></a>
</span><span id="formal_uncertainties_harmonic-596"><a href="#formal_uncertainties_harmonic-596"><span class="linenos">596</span></a>    <span class="k">return</span> <span class="n">sigma_h</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the uncertainty in the harmonic frequencies based on the unconstrained frequency
uncertainties using a simple weighted average.</p>

<p>The base frequency's uncertainty is calculated as:
σ_h1 = (∑ n^2/σ_fn^2)^(-1/2)
The other uncertainties follow as:
σ_hn = n * σ_h1</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>sigma_f</strong> (numpy.ndarray[Any, dtype[float]]):
Uncertainty in the frequency for each sinusoid.</li>
<li><strong>h_base</strong> (numpy.ndarray[Any, dtype[int]]):
Indices of the base frequencies in f_n for each of f_n.</li>
<li><strong>h_mult</strong> (numpy.ndarray[Any, dtype[int]]):
Harmonic multiplier of the base frequency for each of f_n.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray[Any, dtype[float]]</strong>: Uncertainty in the harmonic frequencies.</li>
</ul>
</div>


                </section>
                <section id="formal_uncertainties">
                            <input id="formal_uncertainties-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-nb.njit">@nb.njit(cache=True)</div>

        <span class="def">def</span>
        <span class="name">formal_uncertainties</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">time</span>, </span><span class="param"><span class="n">residuals</span>, </span><span class="param"><span class="n">flux_err</span>, </span><span class="param"><span class="n">a_n</span>, </span><span class="param"><span class="n">i_chunks</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="formal_uncertainties-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#formal_uncertainties"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="formal_uncertainties-599"><a href="#formal_uncertainties-599"><span class="linenos">599</span></a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="formal_uncertainties-600"><a href="#formal_uncertainties-600"><span class="linenos">600</span></a><span class="k">def</span><span class="w"> </span><span class="nf">formal_uncertainties</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">flux_err</span><span class="p">,</span> <span class="n">a_n</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">):</span>
</span><span id="formal_uncertainties-601"><a href="#formal_uncertainties-601"><span class="linenos">601</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the corrected uncorrelated (formal) uncertainties for the extracted</span>
</span><span id="formal_uncertainties-602"><a href="#formal_uncertainties-602"><span class="linenos">602</span></a><span class="sd">    parameters (constant, slope, frequencies, amplitudes and phases).</span>
</span><span id="formal_uncertainties-603"><a href="#formal_uncertainties-603"><span class="linenos">603</span></a>
</span><span id="formal_uncertainties-604"><a href="#formal_uncertainties-604"><span class="linenos">604</span></a><span class="sd">    Harmonics are not taken into account.</span>
</span><span id="formal_uncertainties-605"><a href="#formal_uncertainties-605"><span class="linenos">605</span></a>
</span><span id="formal_uncertainties-606"><a href="#formal_uncertainties-606"><span class="linenos">606</span></a><span class="sd">    Parameters</span>
</span><span id="formal_uncertainties-607"><a href="#formal_uncertainties-607"><span class="linenos">607</span></a><span class="sd">    ----------</span>
</span><span id="formal_uncertainties-608"><a href="#formal_uncertainties-608"><span class="linenos">608</span></a><span class="sd">    time: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-609"><a href="#formal_uncertainties-609"><span class="linenos">609</span></a><span class="sd">        Timestamps of the time series</span>
</span><span id="formal_uncertainties-610"><a href="#formal_uncertainties-610"><span class="linenos">610</span></a><span class="sd">    residuals: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-611"><a href="#formal_uncertainties-611"><span class="linenos">611</span></a><span class="sd">        Residual is flux - model</span>
</span><span id="formal_uncertainties-612"><a href="#formal_uncertainties-612"><span class="linenos">612</span></a><span class="sd">    flux_err: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-613"><a href="#formal_uncertainties-613"><span class="linenos">613</span></a><span class="sd">        Errors in the measurement values</span>
</span><span id="formal_uncertainties-614"><a href="#formal_uncertainties-614"><span class="linenos">614</span></a><span class="sd">    a_n: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-615"><a href="#formal_uncertainties-615"><span class="linenos">615</span></a><span class="sd">        The amplitudes of a number of sine waves</span>
</span><span id="formal_uncertainties-616"><a href="#formal_uncertainties-616"><span class="linenos">616</span></a><span class="sd">    i_chunks: numpy.ndarray[Any, dtype[int]]</span>
</span><span id="formal_uncertainties-617"><a href="#formal_uncertainties-617"><span class="linenos">617</span></a><span class="sd">        Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like</span>
</span><span id="formal_uncertainties-618"><a href="#formal_uncertainties-618"><span class="linenos">618</span></a><span class="sd">        the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</span>
</span><span id="formal_uncertainties-619"><a href="#formal_uncertainties-619"><span class="linenos">619</span></a>
</span><span id="formal_uncertainties-620"><a href="#formal_uncertainties-620"><span class="linenos">620</span></a><span class="sd">    Returns</span>
</span><span id="formal_uncertainties-621"><a href="#formal_uncertainties-621"><span class="linenos">621</span></a><span class="sd">    -------</span>
</span><span id="formal_uncertainties-622"><a href="#formal_uncertainties-622"><span class="linenos">622</span></a><span class="sd">    tuple</span>
</span><span id="formal_uncertainties-623"><a href="#formal_uncertainties-623"><span class="linenos">623</span></a><span class="sd">        A tuple containing the following elements:</span>
</span><span id="formal_uncertainties-624"><a href="#formal_uncertainties-624"><span class="linenos">624</span></a><span class="sd">        sigma_const: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-625"><a href="#formal_uncertainties-625"><span class="linenos">625</span></a><span class="sd">            Uncertainty in the constant for each sector</span>
</span><span id="formal_uncertainties-626"><a href="#formal_uncertainties-626"><span class="linenos">626</span></a><span class="sd">        sigma_slope: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-627"><a href="#formal_uncertainties-627"><span class="linenos">627</span></a><span class="sd">            Uncertainty in the slope for each sector</span>
</span><span id="formal_uncertainties-628"><a href="#formal_uncertainties-628"><span class="linenos">628</span></a><span class="sd">        sigma_f: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-629"><a href="#formal_uncertainties-629"><span class="linenos">629</span></a><span class="sd">            Uncertainty in the frequency for each sine wave</span>
</span><span id="formal_uncertainties-630"><a href="#formal_uncertainties-630"><span class="linenos">630</span></a><span class="sd">        sigma_a: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-631"><a href="#formal_uncertainties-631"><span class="linenos">631</span></a><span class="sd">            Uncertainty in the amplitude for each sine wave (these are identical)</span>
</span><span id="formal_uncertainties-632"><a href="#formal_uncertainties-632"><span class="linenos">632</span></a><span class="sd">        sigma_ph: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="formal_uncertainties-633"><a href="#formal_uncertainties-633"><span class="linenos">633</span></a><span class="sd">            Uncertainty in the phase for each sine wave</span>
</span><span id="formal_uncertainties-634"><a href="#formal_uncertainties-634"><span class="linenos">634</span></a>
</span><span id="formal_uncertainties-635"><a href="#formal_uncertainties-635"><span class="linenos">635</span></a><span class="sd">    Notes</span>
</span><span id="formal_uncertainties-636"><a href="#formal_uncertainties-636"><span class="linenos">636</span></a><span class="sd">    -----</span>
</span><span id="formal_uncertainties-637"><a href="#formal_uncertainties-637"><span class="linenos">637</span></a><span class="sd">    As in Aerts 2021, https://ui.adsabs.harvard.edu/abs/2021RvMP...93a5001A/abstract</span>
</span><span id="formal_uncertainties-638"><a href="#formal_uncertainties-638"><span class="linenos">638</span></a><span class="sd">    The sigma value in the formulae is approximated by taking the maximum of the</span>
</span><span id="formal_uncertainties-639"><a href="#formal_uncertainties-639"><span class="linenos">639</span></a><span class="sd">    standard deviation of the residuals and the standard error of the minimum data error.</span>
</span><span id="formal_uncertainties-640"><a href="#formal_uncertainties-640"><span class="linenos">640</span></a><span class="sd">    Errors in const and slope:</span>
</span><span id="formal_uncertainties-641"><a href="#formal_uncertainties-641"><span class="linenos">641</span></a><span class="sd">    https://pages.mtu.edu/~fmorriso/cm3215/UncertaintySlopeInterceptOfLeastSquaresFit.pdf</span>
</span><span id="formal_uncertainties-642"><a href="#formal_uncertainties-642"><span class="linenos">642</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="formal_uncertainties-643"><a href="#formal_uncertainties-643"><span class="linenos">643</span></a>    <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
</span><span id="formal_uncertainties-644"><a href="#formal_uncertainties-644"><span class="linenos">644</span></a>    <span class="n">n_param</span> <span class="o">=</span> <span class="n">n_parameters</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_chunks</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_n</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># number of parameters in the model</span>
</span><span id="formal_uncertainties-645"><a href="#formal_uncertainties-645"><span class="linenos">645</span></a>    <span class="n">n_dof</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_data</span> <span class="o">-</span> <span class="n">n_param</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># degrees of freedom</span>
</span><span id="formal_uncertainties-646"><a href="#formal_uncertainties-646"><span class="linenos">646</span></a>
</span><span id="formal_uncertainties-647"><a href="#formal_uncertainties-647"><span class="linenos">647</span></a>    <span class="c1"># calculate the standard deviation of the residuals</span>
</span><span id="formal_uncertainties-648"><a href="#formal_uncertainties-648"><span class="linenos">648</span></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">std_unb</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">n_dof</span><span class="p">)</span>
</span><span id="formal_uncertainties-649"><a href="#formal_uncertainties-649"><span class="linenos">649</span></a>
</span><span id="formal_uncertainties-650"><a href="#formal_uncertainties-650"><span class="linenos">650</span></a>    <span class="c1"># calculate the standard error based on the smallest data error</span>
</span><span id="formal_uncertainties-651"><a href="#formal_uncertainties-651"><span class="linenos">651</span></a>    <span class="n">ste</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flux_err</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
</span><span id="formal_uncertainties-652"><a href="#formal_uncertainties-652"><span class="linenos">652</span></a>
</span><span id="formal_uncertainties-653"><a href="#formal_uncertainties-653"><span class="linenos">653</span></a>    <span class="c1"># take the maximum of the standard deviation and standard error as sigma N</span>
</span><span id="formal_uncertainties-654"><a href="#formal_uncertainties-654"><span class="linenos">654</span></a>    <span class="n">sigma_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">ste</span><span class="p">)</span>
</span><span id="formal_uncertainties-655"><a href="#formal_uncertainties-655"><span class="linenos">655</span></a>
</span><span id="formal_uncertainties-656"><a href="#formal_uncertainties-656"><span class="linenos">656</span></a>    <span class="c1"># calculate the D factor (square root of the average number of consecutive data points of the same sign)</span>
</span><span id="formal_uncertainties-657"><a href="#formal_uncertainties-657"><span class="linenos">657</span></a>    <span class="n">positive</span> <span class="o">=</span> <span class="p">(</span><span class="n">residuals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
</span><span id="formal_uncertainties-658"><a href="#formal_uncertainties-658"><span class="linenos">658</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
</span><span id="formal_uncertainties-659"><a href="#formal_uncertainties-659"><span class="linenos">659</span></a>    <span class="n">zero_crossings</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">positive</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">positive</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)]</span>
</span><span id="formal_uncertainties-660"><a href="#formal_uncertainties-660"><span class="linenos">660</span></a>    <span class="n">sss_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">zero_crossings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_data</span><span class="p">])))</span>  <span class="c1"># same-sign sequence indices</span>
</span><span id="formal_uncertainties-661"><a href="#formal_uncertainties-661"><span class="linenos">661</span></a>    <span class="n">d_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sss_i</span><span class="p">)))</span>
</span><span id="formal_uncertainties-662"><a href="#formal_uncertainties-662"><span class="linenos">662</span></a>
</span><span id="formal_uncertainties-663"><a href="#formal_uncertainties-663"><span class="linenos">663</span></a>    <span class="c1"># uncertainty formulae for sinusoids</span>
</span><span id="formal_uncertainties-664"><a href="#formal_uncertainties-664"><span class="linenos">664</span></a>    <span class="n">sigma_f</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
</span><span id="formal_uncertainties-665"><a href="#formal_uncertainties-665"><span class="linenos">665</span></a>    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span>
</span><span id="formal_uncertainties-666"><a href="#formal_uncertainties-666"><span class="linenos">666</span></a>    <span class="n">sigma_ph</span> <span class="o">=</span> <span class="n">d_factor</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_data</span><span class="p">)</span> <span class="o">/</span> <span class="n">a_n</span>  <span class="c1"># times 2 pi w.r.t. the paper</span>
</span><span id="formal_uncertainties-667"><a href="#formal_uncertainties-667"><span class="linenos">667</span></a>
</span><span id="formal_uncertainties-668"><a href="#formal_uncertainties-668"><span class="linenos">668</span></a>    <span class="c1"># make an array of sigma_a (these are the same)</span>
</span><span id="formal_uncertainties-669"><a href="#formal_uncertainties-669"><span class="linenos">669</span></a>    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_n</span><span class="p">),</span> <span class="n">sigma_a</span><span class="p">)</span>
</span><span id="formal_uncertainties-670"><a href="#formal_uncertainties-670"><span class="linenos">670</span></a>
</span><span id="formal_uncertainties-671"><a href="#formal_uncertainties-671"><span class="linenos">671</span></a>    <span class="c1"># linear regression uncertainties</span>
</span><span id="formal_uncertainties-672"><a href="#formal_uncertainties-672"><span class="linenos">672</span></a>    <span class="n">sigma_const</span><span class="p">,</span> <span class="n">sigma_slope</span> <span class="o">=</span> <span class="n">formal_uncertainties_linear</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">i_chunks</span><span class="p">)</span>
</span><span id="formal_uncertainties-673"><a href="#formal_uncertainties-673"><span class="linenos">673</span></a>
</span><span id="formal_uncertainties-674"><a href="#formal_uncertainties-674"><span class="linenos">674</span></a>    <span class="k">return</span> <span class="n">sigma_const</span><span class="p">,</span> <span class="n">sigma_slope</span><span class="p">,</span> <span class="n">sigma_f</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_ph</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the corrected uncorrelated (formal) uncertainties for the extracted
parameters (constant, slope, frequencies, amplitudes and phases).</p>

<p>Harmonics are not taken into account.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>time</strong> (numpy.ndarray[Any, dtype[float]]):
Timestamps of the time series</li>
<li><strong>residuals</strong> (numpy.ndarray[Any, dtype[float]]):
Residual is flux - model</li>
<li><strong>flux_err</strong> (numpy.ndarray[Any, dtype[float]]):
Errors in the measurement values</li>
<li><strong>a_n</strong> (numpy.ndarray[Any, dtype[float]]):
The amplitudes of a number of sine waves</li>
<li><strong>i_chunks</strong> (numpy.ndarray[Any, dtype[int]]):
Pair(s) of indices indicating time chunks within the light curve, separately handled in cases like
the piecewise-linear curve. If only a single curve is wanted, set to np.array([[0, len(time)]]).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple containing the following elements:
sigma_const: numpy.ndarray[Any, dtype[float]]
Uncertainty in the constant for each sector
sigma_slope: numpy.ndarray[Any, dtype[float]]
Uncertainty in the slope for each sector
sigma_f: numpy.ndarray[Any, dtype[float]]
Uncertainty in the frequency for each sine wave
sigma_a: numpy.ndarray[Any, dtype[float]]
Uncertainty in the amplitude for each sine wave (these are identical)
sigma_ph: numpy.ndarray[Any, dtype[float]]
Uncertainty in the phase for each sine wave</li>
</ul>

<h6 id="notes">Notes</h6>

<p>As in Aerts 2021, <a href="https://ui.adsabs.harvard.edu/abs/2021RvMP...93a5001A/abstract">https://ui.adsabs.harvard.edu/abs/2021RvMP...93a5001A/abstract</a>
The sigma value in the formulae is approximated by taking the maximum of the
standard deviation of the residuals and the standard error of the minimum data error.
Errors in const and slope:
<a href="https://pages.mtu.edu/~fmorriso/cm3215/UncertaintySlopeInterceptOfLeastSquaresFit.pdf">https://pages.mtu.edu/~fmorriso/cm3215/UncertaintySlopeInterceptOfLeastSquaresFit.pdf</a></p>
</div>


                </section>
                <section id="linear_regression_uncertainty_ephem">
                            <input id="linear_regression_uncertainty_ephem-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">linear_regression_uncertainty_ephem</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">time</span>, </span><span class="param"><span class="n">p_orb</span>, </span><span class="param"><span class="n">sigma_t</span><span class="o">=</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="linear_regression_uncertainty_ephem-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#linear_regression_uncertainty_ephem"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="linear_regression_uncertainty_ephem-677"><a href="#linear_regression_uncertainty_ephem-677"><span class="linenos">677</span></a><span class="k">def</span><span class="w"> </span><span class="nf">linear_regression_uncertainty_ephem</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">p_orb</span><span class="p">,</span> <span class="n">sigma_t</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="linear_regression_uncertainty_ephem-678"><a href="#linear_regression_uncertainty_ephem-678"><span class="linenos">678</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the linear regression errors on period and t_zero</span>
</span><span id="linear_regression_uncertainty_ephem-679"><a href="#linear_regression_uncertainty_ephem-679"><span class="linenos">679</span></a>
</span><span id="linear_regression_uncertainty_ephem-680"><a href="#linear_regression_uncertainty_ephem-680"><span class="linenos">680</span></a><span class="sd">    Parameters</span>
</span><span id="linear_regression_uncertainty_ephem-681"><a href="#linear_regression_uncertainty_ephem-681"><span class="linenos">681</span></a><span class="sd">    ---------</span>
</span><span id="linear_regression_uncertainty_ephem-682"><a href="#linear_regression_uncertainty_ephem-682"><span class="linenos">682</span></a><span class="sd">    time: numpy.ndarray[Any, dtype[float]]</span>
</span><span id="linear_regression_uncertainty_ephem-683"><a href="#linear_regression_uncertainty_ephem-683"><span class="linenos">683</span></a><span class="sd">        Timestamps of the time series.</span>
</span><span id="linear_regression_uncertainty_ephem-684"><a href="#linear_regression_uncertainty_ephem-684"><span class="linenos">684</span></a><span class="sd">    p_orb: float</span>
</span><span id="linear_regression_uncertainty_ephem-685"><a href="#linear_regression_uncertainty_ephem-685"><span class="linenos">685</span></a><span class="sd">        Orbital period in days.</span>
</span><span id="linear_regression_uncertainty_ephem-686"><a href="#linear_regression_uncertainty_ephem-686"><span class="linenos">686</span></a><span class="sd">    sigma_t: float</span>
</span><span id="linear_regression_uncertainty_ephem-687"><a href="#linear_regression_uncertainty_ephem-687"><span class="linenos">687</span></a><span class="sd">        Error in the individual time measurements.</span>
</span><span id="linear_regression_uncertainty_ephem-688"><a href="#linear_regression_uncertainty_ephem-688"><span class="linenos">688</span></a>
</span><span id="linear_regression_uncertainty_ephem-689"><a href="#linear_regression_uncertainty_ephem-689"><span class="linenos">689</span></a><span class="sd">    Returns</span>
</span><span id="linear_regression_uncertainty_ephem-690"><a href="#linear_regression_uncertainty_ephem-690"><span class="linenos">690</span></a><span class="sd">    -------</span>
</span><span id="linear_regression_uncertainty_ephem-691"><a href="#linear_regression_uncertainty_ephem-691"><span class="linenos">691</span></a><span class="sd">    tuple</span>
</span><span id="linear_regression_uncertainty_ephem-692"><a href="#linear_regression_uncertainty_ephem-692"><span class="linenos">692</span></a><span class="sd">        A tuple containing the following elements:</span>
</span><span id="linear_regression_uncertainty_ephem-693"><a href="#linear_regression_uncertainty_ephem-693"><span class="linenos">693</span></a><span class="sd">        p_err: float</span>
</span><span id="linear_regression_uncertainty_ephem-694"><a href="#linear_regression_uncertainty_ephem-694"><span class="linenos">694</span></a><span class="sd">            Error in the period.</span>
</span><span id="linear_regression_uncertainty_ephem-695"><a href="#linear_regression_uncertainty_ephem-695"><span class="linenos">695</span></a><span class="sd">        t_err: float</span>
</span><span id="linear_regression_uncertainty_ephem-696"><a href="#linear_regression_uncertainty_ephem-696"><span class="linenos">696</span></a><span class="sd">            Error in t_zero.</span>
</span><span id="linear_regression_uncertainty_ephem-697"><a href="#linear_regression_uncertainty_ephem-697"><span class="linenos">697</span></a><span class="sd">        p_t_corr: float</span>
</span><span id="linear_regression_uncertainty_ephem-698"><a href="#linear_regression_uncertainty_ephem-698"><span class="linenos">698</span></a><span class="sd">            Covariance between the period and t_zero.</span>
</span><span id="linear_regression_uncertainty_ephem-699"><a href="#linear_regression_uncertainty_ephem-699"><span class="linenos">699</span></a>
</span><span id="linear_regression_uncertainty_ephem-700"><a href="#linear_regression_uncertainty_ephem-700"><span class="linenos">700</span></a><span class="sd">    Notes</span>
</span><span id="linear_regression_uncertainty_ephem-701"><a href="#linear_regression_uncertainty_ephem-701"><span class="linenos">701</span></a><span class="sd">    -----</span>
</span><span id="linear_regression_uncertainty_ephem-702"><a href="#linear_regression_uncertainty_ephem-702"><span class="linenos">702</span></a><span class="sd">    The number of eclipses, computed from the period and</span>
</span><span id="linear_regression_uncertainty_ephem-703"><a href="#linear_regression_uncertainty_ephem-703"><span class="linenos">703</span></a><span class="sd">    time base, is taken to be a contiguous set.</span>
</span><span id="linear_regression_uncertainty_ephem-704"><a href="#linear_regression_uncertainty_ephem-704"><span class="linenos">704</span></a><span class="sd">    var_matrix:</span>
</span><span id="linear_regression_uncertainty_ephem-705"><a href="#linear_regression_uncertainty_ephem-705"><span class="linenos">705</span></a><span class="sd">    [[std[0]**2          , std[0]*std[1]*corr],</span>
</span><span id="linear_regression_uncertainty_ephem-706"><a href="#linear_regression_uncertainty_ephem-706"><span class="linenos">706</span></a><span class="sd">     [std[0]*std[1]*corr,           std[1]**2]]</span>
</span><span id="linear_regression_uncertainty_ephem-707"><a href="#linear_regression_uncertainty_ephem-707"><span class="linenos">707</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="linear_regression_uncertainty_ephem-708"><a href="#linear_regression_uncertainty_ephem-708"><span class="linenos">708</span></a>    <span class="c1"># number of observed eclipses (technically contiguous)</span>
</span><span id="linear_regression_uncertainty_ephem-709"><a href="#linear_regression_uncertainty_ephem-709"><span class="linenos">709</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">//</span> <span class="n">p_orb</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="linear_regression_uncertainty_ephem-710"><a href="#linear_regression_uncertainty_ephem-710"><span class="linenos">710</span></a>
</span><span id="linear_regression_uncertainty_ephem-711"><a href="#linear_regression_uncertainty_ephem-711"><span class="linenos">711</span></a>    <span class="c1"># the arrays</span>
</span><span id="linear_regression_uncertainty_ephem-712"><a href="#linear_regression_uncertainty_ephem-712"><span class="linenos">712</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># &#39;time&#39; points</span>
</span><span id="linear_regression_uncertainty_ephem-713"><a href="#linear_regression_uncertainty_ephem-713"><span class="linenos">713</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># &#39;positive measurement&#39;</span>
</span><span id="linear_regression_uncertainty_ephem-714"><a href="#linear_regression_uncertainty_ephem-714"><span class="linenos">714</span></a>
</span><span id="linear_regression_uncertainty_ephem-715"><a href="#linear_regression_uncertainty_ephem-715"><span class="linenos">715</span></a>    <span class="c1"># remove points in gaps</span>
</span><span id="linear_regression_uncertainty_ephem-716"><a href="#linear_regression_uncertainty_ephem-716"><span class="linenos">716</span></a>    <span class="n">gaps</span> <span class="o">=</span> <span class="n">mark_gaps</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">min_gap</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
</span><span id="linear_regression_uncertainty_ephem-717"><a href="#linear_regression_uncertainty_ephem-717"><span class="linenos">717</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_between</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">p_orb</span><span class="p">,</span> <span class="n">gaps</span><span class="p">)</span>  <span class="c1"># convert x to time domain</span>
</span><span id="linear_regression_uncertainty_ephem-718"><a href="#linear_regression_uncertainty_ephem-718"><span class="linenos">718</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">n</span><span class="o">//</span><span class="mi">2</span>  <span class="c1"># also centre the time for minimal correlation</span>
</span><span id="linear_regression_uncertainty_ephem-719"><a href="#linear_regression_uncertainty_ephem-719"><span class="linenos">719</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
</span><span id="linear_regression_uncertainty_ephem-720"><a href="#linear_regression_uncertainty_ephem-720"><span class="linenos">720</span></a>
</span><span id="linear_regression_uncertainty_ephem-721"><a href="#linear_regression_uncertainty_ephem-721"><span class="linenos">721</span></a>    <span class="c1"># M</span>
</span><span id="linear_regression_uncertainty_ephem-722"><a href="#linear_regression_uncertainty_ephem-722"><span class="linenos">722</span></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="linear_regression_uncertainty_ephem-723"><a href="#linear_regression_uncertainty_ephem-723"><span class="linenos">723</span></a>
</span><span id="linear_regression_uncertainty_ephem-724"><a href="#linear_regression_uncertainty_ephem-724"><span class="linenos">724</span></a>    <span class="c1"># M^-1</span>
</span><span id="linear_regression_uncertainty_ephem-725"><a href="#linear_regression_uncertainty_ephem-725"><span class="linenos">725</span></a>    <span class="n">matrix_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>  <span class="c1"># inverse (of a general matrix)</span>
</span><span id="linear_regression_uncertainty_ephem-726"><a href="#linear_regression_uncertainty_ephem-726"><span class="linenos">726</span></a>
</span><span id="linear_regression_uncertainty_ephem-727"><a href="#linear_regression_uncertainty_ephem-727"><span class="linenos">727</span></a>    <span class="c1"># M^-1 S M^-1^T, S unit matrix times some sigma (no covariance in the data)</span>
</span><span id="linear_regression_uncertainty_ephem-728"><a href="#linear_regression_uncertainty_ephem-728"><span class="linenos">728</span></a>    <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">matrix_inv</span> <span class="o">@</span> <span class="n">matrix_inv</span><span class="o">.</span><span class="n">T</span>
</span><span id="linear_regression_uncertainty_ephem-729"><a href="#linear_regression_uncertainty_ephem-729"><span class="linenos">729</span></a>    <span class="n">var_matrix</span> <span class="o">=</span> <span class="n">var_matrix</span> <span class="o">*</span> <span class="n">sigma_t</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="linear_regression_uncertainty_ephem-730"><a href="#linear_regression_uncertainty_ephem-730"><span class="linenos">730</span></a>
</span><span id="linear_regression_uncertainty_ephem-731"><a href="#linear_regression_uncertainty_ephem-731"><span class="linenos">731</span></a>    <span class="c1"># errors in the period and t_zero</span>
</span><span id="linear_regression_uncertainty_ephem-732"><a href="#linear_regression_uncertainty_ephem-732"><span class="linenos">732</span></a>    <span class="n">p_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="linear_regression_uncertainty_ephem-733"><a href="#linear_regression_uncertainty_ephem-733"><span class="linenos">733</span></a>    <span class="n">t_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="linear_regression_uncertainty_ephem-734"><a href="#linear_regression_uncertainty_ephem-734"><span class="linenos">734</span></a>    <span class="n">p_t_corr</span> <span class="o">=</span> <span class="n">var_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">t_err</span> <span class="o">*</span> <span class="n">p_err</span><span class="p">)</span>  <span class="c1"># or [1, 0]</span>
</span><span id="linear_regression_uncertainty_ephem-735"><a href="#linear_regression_uncertainty_ephem-735"><span class="linenos">735</span></a>
</span><span id="linear_regression_uncertainty_ephem-736"><a href="#linear_regression_uncertainty_ephem-736"><span class="linenos">736</span></a>    <span class="k">return</span> <span class="n">p_err</span><span class="p">,</span> <span class="n">t_err</span><span class="p">,</span> <span class="n">p_t_corr</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the linear regression errors on period and t_zero</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>time</strong> (numpy.ndarray[Any, dtype[float]]):
Timestamps of the time series.</li>
<li><strong>p_orb</strong> (float):
Orbital period in days.</li>
<li><strong>sigma_t</strong> (float):
Error in the individual time measurements.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple containing the following elements:
p_err: float
Error in the period.
t_err: float
Error in t_zero.
p_t_corr: float
Covariance between the period and t_zero.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The number of eclipses, computed from the period and
time base, is taken to be a contiguous set.
var_matrix:
[[std[0]<strong>2          , std[0]<em>std[1]</em>corr],
 [std[0]<em>std[1]</em>corr,           std[1]</strong>2]]</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>